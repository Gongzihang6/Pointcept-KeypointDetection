<!DOCTYPE html><html lang="zh" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Pointcept-KeypointDetection project.">
      
      
        <meta name="author" content="Gongzihang6">
      
      
        <link rel="canonical" href="https://Gongzihang6.github.io/Pointcept-KeypointDetection/models/PointTransformer/">
      
      
        <link rel="prev" href="../octfomer/">
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>PointTransformer - Pointcept-KeypointDetection</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#point-transformer" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../.." title="Pointcept-KeypointDetection" class="md-header__button md-logo" aria-label="Pointcept-KeypointDetection" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pointcept-KeypointDetection
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PointTransformer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Gongzihang6/Pointcept-KeypointDetection" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    Gongzihang6/Pointcept-KeypointDetection
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  é¦–é¡µ

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../swin3d/" class="md-tabs__link">
          
  
  
  æ¨¡å‹æ¶æ„

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../about.md" class="md-tabs__link">
        
  
  
    
  
  å…³äº

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Pointcept-KeypointDetection" class="md-nav__button md-logo" aria-label="Pointcept-KeypointDetection" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    Pointcept-KeypointDetection
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Gongzihang6/Pointcept-KeypointDetection" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    Gongzihang6/Pointcept-KeypointDetection
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    é¦–é¡µ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    æ¨¡å‹æ¶æ„
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    æ¨¡å‹æ¶æ„
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swin3d/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Swin3D: A Pretrained Transformer Backbone for 3D Indoor Scene Understanding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../octfomer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OctFormerï¼šOctree-based Transformers for 3D Point Clouds
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    PointTransformer
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    PointTransformer
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ptv1" class="md-nav__link">
    <span class="md-ellipsis">
      
        PTv1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PTv1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        èƒŒæ™¯
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transition-down" class="md-nav__link">
    <span class="md-ellipsis">
      
        transition down
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point-transformer-block" class="md-nav__link">
    <span class="md-ellipsis">
      
        point transformer block
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transitionup" class="md-nav__link">
    <span class="md-ellipsis">
      
        transitionUp
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ptv2" class="md-nav__link">
    <span class="md-ellipsis">
      
        PTv2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PTv2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        èƒŒæ™¯
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grouped-vector-attention" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grouped Vector Attention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ptv3" class="md-nav__link">
    <span class="md-ellipsis">
      
        PTv3
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PTv3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        èƒŒæ™¯
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point-cloud-serialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Point Cloud Serialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialized-attention" class="md-nav__link">
    <span class="md-ellipsis">
      
        åºåˆ—åŒ–æ³¨æ„åŠ›ï¼ˆSerialized Attentionï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xcpe" class="md-nav__link">
    <span class="md-ellipsis">
      
        ä½ç½®ç¼–ç ï¼ˆxCPEï¼‰
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    å…³äº
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ptv1" class="md-nav__link">
    <span class="md-ellipsis">
      
        PTv1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PTv1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        èƒŒæ™¯
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transition-down" class="md-nav__link">
    <span class="md-ellipsis">
      
        transition down
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point-transformer-block" class="md-nav__link">
    <span class="md-ellipsis">
      
        point transformer block
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transitionup" class="md-nav__link">
    <span class="md-ellipsis">
      
        transitionUp
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ptv2" class="md-nav__link">
    <span class="md-ellipsis">
      
        PTv2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PTv2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        èƒŒæ™¯
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grouped-vector-attention" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grouped Vector Attention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ptv3" class="md-nav__link">
    <span class="md-ellipsis">
      
        PTv3
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PTv3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        èƒŒæ™¯
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point-cloud-serialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Point Cloud Serialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialized-attention" class="md-nav__link">
    <span class="md-ellipsis">
      
        åºåˆ—åŒ–æ³¨æ„åŠ›ï¼ˆSerialized Attentionï¼‰
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xcpe" class="md-nav__link">
    <span class="md-ellipsis">
      
        ä½ç½®ç¼–ç ï¼ˆxCPEï¼‰
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<p class="theme-switcher-title">
  ğŸ¨ æ¢ä¸ªé¢œè‰²ï¼Œæ¢ä¸ªå¿ƒæƒ…
</p>

<div class="color-picker-container">
  <button class="color-btn" data-color="red" style="background-color: #ef5350;"> red </button>
  <button class="color-btn" data-color="pink" style="background-color: #ec407a;"> pink </button>
  <button class="color-btn" data-color="purple" style="background-color: #ab47bc;"> purple </button>
  <button class="color-btn" data-color="indigo" style="background-color: #5c6bc0;"> indigo </button>
  <button class="color-btn" data-color="blue" style="background-color: #42a5f5;"> blue </button>
  <button class="color-btn" data-color="cyan" style="background-color: #26c6da;"> cyan </button>
  <button class="color-btn" data-color="teal" style="background-color: #26a69a;"> teal </button>
  <button class="color-btn" data-color="green" style="background-color: #66bb6a;"> green </button>
  <button class="color-btn" data-color="orange" style="background-color: #ffa726;"> orange </button>
  <button class="color-btn" data-color="brown" style="background-color: #8d6e63;"> brown </button>
  <button class="color-btn" data-color="grey" style="background-color: #bdbdbd;"> grey </button>
  <button class="color-btn" data-color="black" style="background-color: #000000;"> black </button>
</div>

<script>
  var buttons = document.querySelectorAll('.color-btn');
  var body = document.querySelector('body');
  buttons.forEach(function(btn) {
    btn.addEventListener('click', function() {
      var color = this.getAttribute('data-color');
      body.setAttribute('data-md-color-primary', color);
      localStorage.setItem('user-color-preference', color);
    });
  });
  var savedColor = localStorage.getItem('user-color-preference');
  if (savedColor) { body.setAttribute('data-md-color-primary', savedColor); }
</script>

<h1 id="point-transformer">Point Transformer</h1>
<h2 id="ptv1">PTv1</h2>
<p>å…³é”®è¯ï¼šå‘é‡æ³¨æ„åŠ›ï¼ˆVector Attentionï¼‰ã€å±€éƒ¨é‚»åŸŸï¼ˆLocal Neighborhoodï¼‰ã€å¯å­¦ä¹ ä½ç½®ç¼–ç ï¼›</p>
<h3 id="_1">èƒŒæ™¯</h3>
<p>Self-attention åœ¨ NLP å’Œ 2D å›¾åƒé¢†åŸŸå–å¾—äº†å·¨å¤§æˆåŠŸï¼Œç‚¹äº‘æœ¬è´¨ä¸Šæ˜¯åµŒå…¥åœ¨åº¦é‡ç©ºé—´ä¸­çš„å‡ ä½•ï¼Œå…·æœ‰æ’åˆ—ä¸å˜æ€§ï¼Œè¿™ä¸ transformer çš„æ ¸å¿ƒæ“ä½œï¼ˆè‡ªæ³¨æ„åŠ›ï¼Œé›†åˆç®—å­ï¼ˆSet Operatorï¼‰ï¼‰é«˜åº¦å¥‘åˆã€‚</p>
<p><strong>è§£å†³çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>ä»¥å¾€çš„ç‚¹äº‘ç½‘ç»œï¼ˆå¦‚ Pointnet++ï¼‰ä½¿ç”¨æœ€å¤§æ± åŒ–æ¥èšåˆä¿¡æ¯ï¼Œå¯èƒ½ä¸¢å¤±å±€éƒ¨ç»†èŠ‚ï¼›</li>
<li>ä»¥å¾€çš„ 3D æ³¨æ„åŠ›å°è¯•é€šå¸¸æ˜¯å…¨å±€çš„ï¼ˆè®¡ç®—é‡è¿‡å¤§ï¼‰æˆ–ç›´æ¥æ²¿ç”¨æ ‡é‡ç‚¹ç§¯æ³¨æ„åŠ›ï¼ˆScalar Dot-production Attentionï¼‰ï¼Œæœªèƒ½å……åˆ†åˆ©ç”¨ 3D ç©ºé—´ä¿¡æ¯ï¼›</li>
</ul>
<p>æ ¸å¿ƒåˆ›æ–°ä¸ç½‘ç»œç»“æ„ï¼š</p>
<p>1ã€<strong>Point Transformer Layer (æ ¸å¿ƒå±‚)</strong> è¿™æ˜¯ç½‘ç»œçš„åŸºæœ¬æ„å»ºå—ï¼Œå…¶æ ¸å¿ƒæ˜¯ <strong>å‘é‡è‡ªæ³¨æ„åŠ› (Vector Self-Attention)</strong> æœºåˆ¶ï¼Œè€Œéæ ‡å‡†çš„æ ‡é‡æ³¨æ„åŠ›ã€‚ä¼ ç»Ÿçš„æ ‡é‡æ³¨æ„åŠ›ï¼Œè®¡ç®—æ¯ä¸ªç‚¹çš„æƒé‡ï¼Œç„¶åå¯¹æ¯ä¸ªç‚¹çš„æ‰€æœ‰ç‰¹å¾éƒ½æŒ‰ç…§åŒä¸€ä¸ªæƒé‡è¿›è¡ŒåŠ æƒï¼Œç„¶åç´¯åŠ æ±‚å’Œï¼›ä½†æ˜¯å‘é‡è‡ªæ³¨æ„åŠ›ï¼Œé€šè¿‡ mlp è®¡ç®—ç‚¹çš„ç›¸å¯¹æƒé‡ï¼ˆä½¿ç”¨ <code>x_k-x_q+p_r</code> ä½œä¸ºç‰¹å¾ï¼‰æ—¶ï¼ŒæŠŠç‚¹çš„ç‰¹å¾ç»´åº¦åˆ†ä¸º <span class="arithmatex">\(s\)</span> ç»„ï¼Œè¿™æ ·è®¡ç®—æŸä¸ªç‚¹çš„è´¡çŒ®æ—¶ï¼Œå®ƒçš„æ‰€æœ‰ç‰¹å¾ä¸æ˜¯éƒ½å…·æœ‰ç›¸åŒçš„è´¡çŒ®ï¼Œç‰¹å¾èšåˆå’Œè¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚å…·ä½“è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<div class="arithmatex">\[
y_{i} = \sum_{x_{j} \in \mathcal{X}(i)} \rho(\gamma(\varphi(x_{i}) - \psi(x_{j}) + \delta)) \odot (\alpha(x_{j}) + \delta)
\]</div>
<p>å…¶ä¸­ <span class="arithmatex">\(\mathcal{X}(i)\)</span> è¡¨ç¤º <span class="arithmatex">\(x_i\)</span> çš„é‚»åŸŸï¼Œ <span class="arithmatex">\(\alpha()\)</span> è¡¨ç¤ºçº¿æ€§å˜æ¢ <code>linear_v</code>ï¼Œç±»ä¼¼è‡ªæ³¨æ„åŠ›é‡Œé¢çš„ <span class="arithmatex">\(W^V\)</span>ï¼›<span class="arithmatex">\(\delta\)</span> æ˜¯ä½ç½®ç¼–ç ï¼Œä½¿ç”¨å½“å‰ç‚¹å’Œå½“å‰ç‚¹çš„ KNN è·å–çš„é‚»å±…ç‚¹çš„åæ ‡å·®ä½¿ç”¨ <code>linear_p</code> çº¿æ€§å˜æ¢è·å–ï¼›<span class="arithmatex">\(\varphi()\)</span> è¡¨ç¤ºçº¿æ€§å˜æ¢ <code>linear_k</code>ï¼Œ<span class="arithmatex">\(\psi()\)</span> è¡¨ç¤ºçº¿æ€§å˜æ¢ <code>linear_q</code>ï¼Œç›¸å½“äºè‡ªæ³¨æ„åŠ›é‡Œé¢çš„ <span class="arithmatex">\(W^K\)</span> å’Œ <span class="arithmatex">\(W^Q\)</span>ï¼›<span class="arithmatex">\(\gamma()\)</span> æ˜¯çº¿æ€§å˜æ¢ <code>linear_W</code>ï¼Œç”¨äºè®¡ç®—æƒé‡ï¼›<span class="arithmatex">\(\rho()\)</span> æ˜¯å½’ä¸€åŒ–å‡½æ•°ï¼Œå°†æƒé‡å½’ä¸€åŒ–ï¼Œæ¯”å¦‚ softmax å‡½æ•°ï¼›<span class="arithmatex">\(\odot\)</span> æ˜¯å“ˆè¾¾ç›ç§¯ï¼Œè¡¨ç¤ºé€å…ƒç´ ç›¸ä¹˜ï¼›</p>
<p>å…¶ä¸­ <span class="arithmatex">\(x_i(n,c)\)</span> æ˜¯æˆ‘ä»¬å½“å‰è¦æ›´æ–°ç‰¹å¾çš„ç‚¹ï¼Œ<span class="arithmatex">\(x_j(n,k,c)\)</span> æ˜¯ <span class="arithmatex">\(x_i\)</span> ä½¿ç”¨ KNN æŸ¥è¯¢è·å–åˆ°çš„é‚»å±…ç‚¹ï¼Œæ‰€ä»¥åæ ‡å·®çš„å½¢çŠ¶æ˜¯ <span class="arithmatex">\((n,k,c)\)</span>ï¼Œæƒé‡å½¢çŠ¶ä¸º <span class="arithmatex">\((n,k,c/s)\)</span>ï¼›åœ¨è®¡ç®—çš„æ—¶å€™ï¼Œå°† <span class="arithmatex">\(\alpha(x_j)\)</span> çš„ <span class="arithmatex">\((n,k,c)\)</span> æ‹†åˆ†ä¸º <span class="arithmatex">\((n,k,s,c/s)\)</span>ï¼Œä¹Ÿå°±æ˜¯å°†é€šé“ç»´åˆ†ç»„ï¼Œåˆ†æˆ <span class="arithmatex">\(s\)</span> ç»„ï¼Œç»„å†…å…±äº«æ³¨æ„åŠ›æƒé‡ï¼Œç»„é—´æƒé‡ä¸åŒï¼Œå®ç°æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œç»„ <span class="arithmatex">\(s\)</span> è¶Šå°ï¼Œç²’åº¦è¶Šç»†ã€‚</p>
<p>2ã€<strong>å±€éƒ¨æ³¨æ„åŠ›ï¼š</strong> ä¸ºäº†å¤„ç†å¤§è§„æ¨¡åœºæ™¯ï¼Œæ³¨æ„åŠ›é™åˆ¶åœ¨å±€éƒ¨é‚»åŸŸå†…ï¼ˆé€šè¿‡ k-NN æœç´¢ <span class="arithmatex">\(k\)</span> ä¸ªæœ€è¿‘é‚»ï¼‰ï¼Œè€Œä¸æ˜¯å…¨å±€ ã€‚</p>
<p>æ•´ä½“æ¶æ„</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ•´ä½“æ¶æ„é‡‡ç”¨äº†ç»å…¸çš„ U-Net ç»“æ„ï¼ˆç¼–ç å™¨-è§£ç å™¨ï¼‰ï¼ŒåŒ…å«ä¸‹é‡‡æ ·ï¼ˆTransition Downï¼‰å’Œä¸Šé‡‡æ ·ï¼ˆTransition Upï¼‰æ¨¡å—ï¼Œä»¥åŠæ ¸å¿ƒçš„ point transformer blockï¼ˆå€Ÿé‰´äº† Botterneck çš„ç»“æ„ï¼‰</p>
<p></p><figure id="_figure-1"><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C11%5Cimage-20251128212829097.png" data-desc-position="bottom"><img alt="ptv1 ç½‘ç»œæ•´ä½“æ¶æ„å›¾" src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C11%5Cimage-20251128212829097.png"></a><figcaption>Figure 1: ptv1 ç½‘ç»œæ•´ä½“æ¶æ„å›¾</figcaption></figure><p></p>
<h3 id="transition-down">transition down</h3>
<p>ä¸‹é‡‡æ ·æ¨¡å—ï¼Œå®ç°æ–¹æ³•å¦‚ä¸‹å›¾æµç¨‹æ‰€ç¤ºï¼Œä¸»è¦åŒ…æ‹¬ FPS æœ€è¿œç‚¹é‡‡æ ·å’Œ KNN é‚»åŸŸæŸ¥è¯¢ï¼Œå¯¹äºåŸå§‹è¾“å…¥ç‚¹åæ ‡ï¼ˆé€šå¸¸æ˜¯ <span class="arithmatex">\(x,y,z\)</span>ï¼‰å’Œç‰¹å¾ï¼ˆé€šå¸¸æ˜¯é¢œè‰² RGB æˆ–è€…æ³•å‘é‡ï¼‰ï¼Œå‡è®¾åŸå§‹è¾“å…¥ç‚¹äº‘ç‚¹ä¸ªæ•°ä¸º <span class="arithmatex">\(N\)</span>ï¼Œé¦–å…ˆç»è¿‡ FPS ä¸‹é‡‡æ ·é€‰æ‹© <span class="arithmatex">\(M\)</span> ä¸ªç‚¹ä½œä¸ºç‰¹å¾ç‚¹ï¼Œç„¶åä»¥è¿™ <span class="arithmatex">\(M\)</span> ä¸ªç‰¹å¾ç‚¹ä¸ºä¸­å¿ƒï¼ŒæŸ¥è¯¢é‚»åŸŸå†…æœ€è¿‘çš„ <span class="arithmatex">\(K\)</span> ä¸ªç‚¹ï¼Œèšåˆè¿™ <span class="arithmatex">\(K\)</span> ä¸ªç‚¹çš„åæ ‡å’Œç‰¹å¾ï¼Œè¿™å°±å¾—åˆ°äº† Linear å±‚çš„è¾“å…¥ <span class="arithmatex">\((M,K,C_{in}+3)\)</span>ï¼Œç„¶åç»è¿‡ Linear å±‚å¤„ç†ï¼Œæå‡ç‰¹å¾ç»´åº¦åˆ° <span class="arithmatex">\(C_{out}\)</span>ï¼Œç„¶ååœ¨ <span class="arithmatex">\(K\)</span> è¿™ä¸ªç»´åº¦ä¸Šè¿›è¡Œæœ€å¤§æ± åŒ–ï¼Œå¾—åˆ°è¿™ <span class="arithmatex">\(M\)</span> ä¸ªç‚¹çš„æ–°ç‰¹å¾ <span class="arithmatex">\((M,C_{out})\)</span>ï¼Œç„¶åå’Œè¿™ <span class="arithmatex">\(M\)</span> ä¸ªç‚¹çš„åæ ‡ï¼Œä¸€èµ·è¿”å›ã€‚</p>
<p></p><figure id="_figure-2"><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5CGenerated%20Image%20December%2025%2C%202025%20-%205_28PM.jpeg" data-desc-position="bottom"><img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5CGenerated%20Image%20December%2025%2C%202025%20-%205_28PM.jpeg" alt="Generated Image December 25, 2025 - 5_28PM" style="zoom: 50%;"></a><figcaption>Figure 2: Generated Image December 25, 2025 - 5_28PM</figcaption></figure><p></p>
<p>å…·ä½“ä»£ç å®ç°å¦‚ä¸‹ï¼šä½äº <code>pointcept/models/point_transformer/point_transformer_seg.py</code> ä¸­</p>
<details class="note">
<summary>Note</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pxo</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="n">pxo</span>  <span class="c1"># (n, 3), (n, c), (b)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="n">n_o</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span>   <span class="c1"># è®¡ç®—ä¸‹é‡‡æ ·åçš„ç‚¹äº‘æ•°é‡</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos=" 6 "></span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos=" 7 "></span></a>            <span class="n">n_o</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos=" 8 "></span></a>            <span class="n">n_o</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">IntTensor</span><span class="p">(</span><span class="n">n_o</span><span class="p">)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos=" 9 "></span></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><a href="#__codelineno-0-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="c1"># [æ ¸å¿ƒæ“ä½œ 1] æœ€è¿œç‚¹é‡‡æ · (FPS)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><a href="#__codelineno-0-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="c1"># ä»åŸå§‹ç‚¹äº‘ p ä¸­ï¼Œæ ¹æ® n_o è§„å®šçš„æ•°é‡ï¼Œé‡‡æ ·å‡ºåˆ†å¸ƒæœ€è¿œçš„å…³é”®ç‚¹ç´¢å¼• idx</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><a href="#__codelineno-0-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="c1"># idx å½¢çŠ¶ä¸º (m)ï¼Œm æ˜¯ä¸‹é‡‡æ ·åçš„æ€»ç‚¹æ•°ï¼Œä¸‹é‡‡æ ·åçš„æ€»ç‚¹æ•°ç”±strideå†³å®š</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><a href="#__codelineno-0-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">pointops</span><span class="o">.</span><span class="n">farthest_point_sampling</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">n_o</span><span class="p">)</span>  <span class="c1"># (m)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><a href="#__codelineno-0-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="c1"># è·å–é‡‡æ ·åçš„æ–°åæ ‡ n_pï¼Œå½¢çŠ¶ (m, 3)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><a href="#__codelineno-0-15"><span class="linenos" data-linenos="15 "></span></a>            <span class="n">n_p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span> <span class="p">:]</span>  <span class="c1"># (m, 3)</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><a href="#__codelineno-0-16"><span class="linenos" data-linenos="16 "></span></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><a href="#__codelineno-0-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="c1"># [æ ¸å¿ƒæ“ä½œ 2] kNN æŸ¥è¯¢ä¸åˆ†ç»„</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><a href="#__codelineno-0-18"><span class="linenos" data-linenos="18 "></span></a>            <span class="c1"># å¯¹äºæ¯ä¸ªæ–°ç‚¹ n_pï¼Œåœ¨è€ç‚¹ p ä¸­æ‰¾åˆ°æœ€è¿‘çš„ nsample ä¸ªé‚»å±…</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><a href="#__codelineno-0-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="c1"># å¹¶å°†é‚»å±…çš„ç‰¹å¾èšé›†èµ·æ¥ï¼ŒknnæŸ¥è¯¢çš„é‚»åŸŸç‚¹æ•°é‡ç”±nsampleå†³å®š</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><a href="#__codelineno-0-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pointops</span><span class="o">.</span><span class="n">knn_query_and_group</span><span class="p">(</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><a href="#__codelineno-0-21"><span class="linenos" data-linenos="21 "></span></a>                <span class="n">x</span><span class="p">,</span>                      <span class="c1"># è¾“å…¥ç‰¹å¾</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><a href="#__codelineno-0-22"><span class="linenos" data-linenos="22 "></span></a>                <span class="n">p</span><span class="p">,</span>                      <span class="c1"># è¾“å…¥åæ ‡</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><a href="#__codelineno-0-23"><span class="linenos" data-linenos="23 "></span></a>                <span class="n">offset</span><span class="o">=</span><span class="n">o</span><span class="p">,</span>               <span class="c1"># è¾“å…¥ offset</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><a href="#__codelineno-0-24"><span class="linenos" data-linenos="24 "></span></a>                <span class="n">new_xyz</span><span class="o">=</span><span class="n">n_p</span><span class="p">,</span>            <span class="c1"># ä¸­å¿ƒç‚¹åæ ‡ (æ–°çš„ç‚¹)</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><a href="#__codelineno-0-25"><span class="linenos" data-linenos="25 "></span></a>                <span class="n">new_offset</span><span class="o">=</span><span class="n">n_o</span><span class="p">,</span>         <span class="c1"># ä¸­å¿ƒç‚¹ offset</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><a href="#__codelineno-0-26"><span class="linenos" data-linenos="26 "></span></a>                <span class="n">nsample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nsample</span><span class="p">,</span>   <span class="c1"># kNN çš„ k (å¦‚ 16)</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><a href="#__codelineno-0-27"><span class="linenos" data-linenos="27 "></span></a>                <span class="n">with_xyz</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>          <span class="c1"># å…³é”®å‚æ•°ï¼šTrue è¡¨ç¤ºè¿”å›çš„ç‰¹å¾ä¸­åŒ…å«ç›¸å¯¹åæ ‡ (p_neighbor - p_center)</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><a href="#__codelineno-0-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="p">)</span>   <span class="c1"># æ­¤æ—¶ x çš„å½¢çŠ¶é€šå¸¸ä¸º (m, nsample, 3 + c)</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><a href="#__codelineno-0-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><a href="#__codelineno-0-30"><span class="linenos" data-linenos="30 "></span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">())</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><a href="#__codelineno-0-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="p">)</span>  <span class="c1"># (m, c_out, nsample)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><a href="#__codelineno-0-32"><span class="linenos" data-linenos="32 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (m, c_out)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><a href="#__codelineno-0-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="n">n_p</span><span class="p">,</span> <span class="n">n_o</span>     <span class="c1"># m 3  m</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><a href="#__codelineno-0-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="k">else</span><span class="p">:</span>   <span class="c1"># å¦‚æœæ­¥é•¿strideä¸º1ï¼Œä¸è¿›è¡Œä¸‹é‡‡æ ·ï¼Œç›´æ¥è¿›è¡Œçº¿æ€§å˜æ¢</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><a href="#__codelineno-0-35"><span class="linenos" data-linenos="35 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1"># (n, c_out)</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><a href="#__codelineno-0-36"><span class="linenos" data-linenos="36 "></span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">]</span>
</span></code></pre></div>
</details>
<h3 id="point-transformer-block">point transformer block</h3>
<p>è¿™é‡Œå€Ÿé‰´äº† BottnerNeck çš„æ®‹å·®è¿æ¥ç»“æ„ï¼Œé¿å…ç½‘ç»œå±‚æ•°å¯¼è‡´çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚å…·ä½“ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p>
<p></p><figure id="_figure-3"><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5CGenerated%20Image%20December%2025%2C%202025%20-%206_02PM.jpeg" data-desc-position="bottom"><img alt="point transformer block" src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5CGenerated%20Image%20December%2025%2C%202025%20-%206_02PM.jpeg"></a><figcaption>Figure 3: point transformer block</figcaption></figure><p></p>
<p>æ ¸å¿ƒæ˜¯ä¸­é—´çš„ point Transformer Layer å±‚ï¼Œå‰é¢å·²ç»ä»‹ç»äº†å…¬å¼å’Œè®¡ç®—æµç¨‹ã€‚ä¸‹é¢æ˜¯å®ç°ä»£ç ï¼š</p>
<details class="note">
<summary>Note</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="  1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">PointTransformerLayer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="  2 "></span></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos="  3 "></span></a><span class="sd">    point transformerå±‚</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos="  4 "></span></a><span class="sd">    â€œä½“ä¼šåŸºäºMLPçš„å‘é‡è‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œæ™®é€šçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„å·®å¼‚â€</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos="  5 "></span></a><span class="sd">    æ ¹æ®è®ºæ–‡ä¸­fig 2ç»“æ„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¯¹è¾“å…¥ç‚¹äº‘è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos="  6 "></span></a><span class="sd">    1ã€å¯¹è¾“å…¥ç‚¹äº‘çš„ç‰¹å¾xè¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå¾—åˆ°æŸ¥è¯¢ç‚¹ã€é”®ç‚¹ã€å€¼ç‚¹çš„ç‰¹å¾è¡¨ç¤ºï¼›</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos="  7 "></span></a><span class="sd">    2ã€å¯¹é”®ç‚¹å’Œå€¼ç‚¹è¿›è¡Œknn_and_groupæ“ä½œï¼Œå¾—åˆ°æ¯ä¸ªæŸ¥è¯¢ç‚¹çš„nsampleä¸ªæœ€è¿‘é‚»é”®ç‚¹çš„ç‰¹å¾è¡¨ç¤ºï¼›</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos="  8 "></span></a><span class="sd">                Input: (p, x, o)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos="  9 "></span></a><span class="sd">                        |</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><a href="#__codelineno-1-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="sd">    +-----------------+-----------------+</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><a href="#__codelineno-1-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="sd">    |                 |                 |</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><a href="#__codelineno-1-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="sd">[linear_q]        [linear_k]        [linear_v]</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><a href="#__codelineno-1-13"><span class="linenos" data-linenos=" 13 "></span></a><span class="sd">    |                 |                 |</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><a href="#__codelineno-1-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="sd">    x_q               x_k               x_v</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><a href="#__codelineno-1-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="sd">    |                 |                 |</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><a href="#__codelineno-1-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="sd">    |          [ KNN &amp; Grouping ] &lt;-----+--- (uses p, o)</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><a href="#__codelineno-1-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="sd">    |           /     |             \</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a><a href="#__codelineno-1-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="sd">    |    (neighbors) (neighbors)  (relative p)</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a><a href="#__codelineno-1-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="sd">    |      x_k       x_v             p_r</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a><a href="#__codelineno-1-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="sd">    |       |         |               |</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a><a href="#__codelineno-1-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="sd">    |       |         |          [linear_p]</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a><a href="#__codelineno-1-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="sd">    |       |         |               |</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a><a href="#__codelineno-1-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="sd">    |       |         |               v (pos encoding)</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a><a href="#__codelineno-1-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="sd">    |       |         |           +---+---+</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a><a href="#__codelineno-1-25"><span class="linenos" data-linenos=" 25 "></span></a><span class="sd">    |       |         |           |       |</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a><a href="#__codelineno-1-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="sd">    v       v         |           v       v</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><a href="#__codelineno-1-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="sd">(x_k - x_q + p_r)    |        (x_v  +  p_r)</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a><a href="#__codelineno-1-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="sd">        |             |               |</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a><a href="#__codelineno-1-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="sd">    (r_qk)           |               |</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30"></a><a href="#__codelineno-1-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="sd">        |             |               |</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31"></a><a href="#__codelineno-1-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="sd">    [linear_w]        |               |</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32"></a><a href="#__codelineno-1-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="sd">        |             |               |</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33"></a><a href="#__codelineno-1-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="sd">    [Softmax]         |               |</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34"></a><a href="#__codelineno-1-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="sd">        |             |               |</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35"></a><a href="#__codelineno-1-35"><span class="linenos" data-linenos=" 35 "></span></a><span class="sd">        (w)             |               |</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36"></a><a href="#__codelineno-1-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="sd">        \             |               /</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37"></a><a href="#__codelineno-1-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="sd">        \-----------(âŠ—)-------------/</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38"></a><a href="#__codelineno-1-38"><span class="linenos" data-linenos=" 38 "></span></a><span class="sd">                        |</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39"></a><a href="#__codelineno-1-39"><span class="linenos" data-linenos=" 39 "></span></a><span class="sd">                [ einsum ] (Weighted Sum)</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40"></a><a href="#__codelineno-1-40"><span class="linenos" data-linenos=" 40 "></span></a><span class="sd">                        |</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41"></a><a href="#__codelineno-1-41"><span class="linenos" data-linenos=" 41 "></span></a><span class="sd">                        v</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42"></a><a href="#__codelineno-1-42"><span class="linenos" data-linenos=" 42 "></span></a><span class="sd">                    Output: (p, x, o)</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43"></a><a href="#__codelineno-1-43"><span class="linenos" data-linenos=" 43 "></span></a><span class="sd">    """</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44"></a><a href="#__codelineno-1-44"><span class="linenos" data-linenos=" 44 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_planes</span><span class="p">,</span> <span class="n">out_planes</span><span class="p">,</span> <span class="n">share_planes</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">nsample</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45"></a><a href="#__codelineno-1-45"><span class="linenos" data-linenos=" 45 "></span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46"></a><a href="#__codelineno-1-46"><span class="linenos" data-linenos=" 46 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mid_planes</span> <span class="o">=</span> <span class="n">mid_planes</span> <span class="o">=</span> <span class="n">out_planes</span> <span class="o">//</span> <span class="mi">1</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47"></a><a href="#__codelineno-1-47"><span class="linenos" data-linenos=" 47 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">out_planes</span> <span class="o">=</span> <span class="n">out_planes</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48"></a><a href="#__codelineno-1-48"><span class="linenos" data-linenos=" 48 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">share_planes</span> <span class="o">=</span> <span class="n">share_planes</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49"></a><a href="#__codelineno-1-49"><span class="linenos" data-linenos=" 49 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nsample</span> <span class="o">=</span> <span class="n">nsample</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50"></a><a href="#__codelineno-1-50"><span class="linenos" data-linenos=" 50 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear_q</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_planes</span><span class="p">,</span> <span class="n">mid_planes</span><span class="p">)</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51"></a><a href="#__codelineno-1-51"><span class="linenos" data-linenos=" 51 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear_k</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_planes</span><span class="p">,</span> <span class="n">mid_planes</span><span class="p">)</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52"></a><a href="#__codelineno-1-52"><span class="linenos" data-linenos=" 52 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear_v</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_planes</span><span class="p">,</span> <span class="n">out_planes</span><span class="p">)</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53"></a><a href="#__codelineno-1-53"><span class="linenos" data-linenos=" 53 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear_p</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54"></a><a href="#__codelineno-1-54"><span class="linenos" data-linenos=" 54 "></span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55"></a><a href="#__codelineno-1-55"><span class="linenos" data-linenos=" 55 "></span></a>            <span class="n">LayerNorm1d</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56"></a><a href="#__codelineno-1-56"><span class="linenos" data-linenos=" 56 "></span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57"></a><a href="#__codelineno-1-57"><span class="linenos" data-linenos=" 57 "></span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">out_planes</span><span class="p">),</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58"></a><a href="#__codelineno-1-58"><span class="linenos" data-linenos=" 58 "></span></a>        <span class="p">)</span>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59"></a><a href="#__codelineno-1-59"><span class="linenos" data-linenos=" 59 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linear_w</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60"></a><a href="#__codelineno-1-60"><span class="linenos" data-linenos=" 60 "></span></a>            <span class="n">LayerNorm1d</span><span class="p">(</span><span class="n">mid_planes</span><span class="p">),</span>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61"></a><a href="#__codelineno-1-61"><span class="linenos" data-linenos=" 61 "></span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62"></a><a href="#__codelineno-1-62"><span class="linenos" data-linenos=" 62 "></span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">mid_planes</span><span class="p">,</span> <span class="n">out_planes</span> <span class="o">//</span> <span class="n">share_planes</span><span class="p">),</span>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63"></a><a href="#__codelineno-1-63"><span class="linenos" data-linenos=" 63 "></span></a>            <span class="n">LayerNorm1d</span><span class="p">(</span><span class="n">out_planes</span> <span class="o">//</span> <span class="n">share_planes</span><span class="p">),</span>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64"></a><a href="#__codelineno-1-64"><span class="linenos" data-linenos=" 64 "></span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65"></a><a href="#__codelineno-1-65"><span class="linenos" data-linenos=" 65 "></span></a>            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">out_planes</span> <span class="o">//</span> <span class="n">share_planes</span><span class="p">,</span> <span class="n">out_planes</span> <span class="o">//</span> <span class="n">share_planes</span><span class="p">),</span>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66"></a><a href="#__codelineno-1-66"><span class="linenos" data-linenos=" 66 "></span></a>        <span class="p">)</span>
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67"></a><a href="#__codelineno-1-67"><span class="linenos" data-linenos=" 67 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68"></a><a href="#__codelineno-1-68"><span class="linenos" data-linenos=" 68 "></span></a>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69"></a><a href="#__codelineno-1-69"><span class="linenos" data-linenos=" 69 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pxo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70"></a><a href="#__codelineno-1-70"><span class="linenos" data-linenos=" 70 "></span></a>        <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="n">pxo</span>  <span class="c1"># (n, 3), (n, c), (b)</span>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71"></a><a href="#__codelineno-1-71"><span class="linenos" data-linenos=" 71 "></span></a>        <span class="n">x_q</span><span class="p">,</span> <span class="n">x_k</span><span class="p">,</span> <span class="n">x_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_q</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_k</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_v</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72"></a><a href="#__codelineno-1-72"><span class="linenos" data-linenos=" 72 "></span></a>        <span class="n">x_k</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">pointops</span><span class="o">.</span><span class="n">knn_query_and_group</span><span class="p">(</span>    <span class="c1"># è¿›è¡ŒKNNæŸ¥è¯¢æœ€è¿‘çš„nsampleä¸ªç‚¹ï¼Œå› ä¸ºwith_xyzè®¾ç½®ä¸ºtrueï¼Œè¿”å›çš„x_kä¸­çš„å‰3ç»´æ˜¯åæ ‡å·®ï¼Œç„¶åCç»´æ˜¯ç‰¹å¾ç»´åº¦</span>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73"></a><a href="#__codelineno-1-73"><span class="linenos" data-linenos=" 73 "></span></a>            <span class="n">x_k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">new_xyz</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">new_offset</span><span class="o">=</span><span class="n">o</span><span class="p">,</span> <span class="n">nsample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nsample</span><span class="p">,</span> <span class="n">with_xyz</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74"></a><a href="#__codelineno-1-74"><span class="linenos" data-linenos=" 74 "></span></a>        <span class="p">)</span>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75"></a><a href="#__codelineno-1-75"><span class="linenos" data-linenos=" 75 "></span></a>        <span class="n">x_v</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pointops</span><span class="o">.</span><span class="n">knn_query_and_group</span><span class="p">(</span>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76"></a><a href="#__codelineno-1-76"><span class="linenos" data-linenos=" 76 "></span></a>            <span class="n">x_v</span><span class="p">,</span>
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77"></a><a href="#__codelineno-1-77"><span class="linenos" data-linenos=" 77 "></span></a>            <span class="n">p</span><span class="p">,</span>
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78"></a><a href="#__codelineno-1-78"><span class="linenos" data-linenos=" 78 "></span></a>            <span class="n">o</span><span class="p">,</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79"></a><a href="#__codelineno-1-79"><span class="linenos" data-linenos=" 79 "></span></a>            <span class="n">new_xyz</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80"></a><a href="#__codelineno-1-80"><span class="linenos" data-linenos=" 80 "></span></a>            <span class="n">new_offset</span><span class="o">=</span><span class="n">o</span><span class="p">,</span>
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81"></a><a href="#__codelineno-1-81"><span class="linenos" data-linenos=" 81 "></span></a>            <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82"></a><a href="#__codelineno-1-82"><span class="linenos" data-linenos=" 82 "></span></a>            <span class="n">nsample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nsample</span><span class="p">,</span>
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83"></a><a href="#__codelineno-1-83"><span class="linenos" data-linenos=" 83 "></span></a>            <span class="n">with_xyz</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84"></a><a href="#__codelineno-1-84"><span class="linenos" data-linenos=" 84 "></span></a>        <span class="p">)</span>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85"></a><a href="#__codelineno-1-85"><span class="linenos" data-linenos=" 85 "></span></a>        <span class="n">p_r</span><span class="p">,</span> <span class="n">x_k</span> <span class="o">=</span> <span class="n">x_k</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">x_k</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">:]</span>
</span><span id="__span-1-86"><a id="__codelineno-1-86" name="__codelineno-1-86"></a><a href="#__codelineno-1-86"><span class="linenos" data-linenos=" 86 "></span></a>        <span class="n">p_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_p</span><span class="p">(</span><span class="n">p_r</span><span class="p">)</span>    <span class="c1"># ä½¿ç”¨på’Œpçš„é‚»å±…çš„åæ ‡å·®è¿›è¡Œä½ç½®ç¼–ç </span>
</span><span id="__span-1-87"><a id="__codelineno-1-87" name="__codelineno-1-87"></a><a href="#__codelineno-1-87"><span class="linenos" data-linenos=" 87 "></span></a>        <span class="n">r_qk</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-1-88"><a id="__codelineno-1-88" name="__codelineno-1-88"></a><a href="#__codelineno-1-88"><span class="linenos" data-linenos=" 88 "></span></a>            <span class="n">x_k</span>     <span class="c1"># n k c</span>
</span><span id="__span-1-89"><a id="__codelineno-1-89" name="__codelineno-1-89"></a><a href="#__codelineno-1-89"><span class="linenos" data-linenos=" 89 "></span></a>            <span class="o">-</span> <span class="n">x_q</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># n 1 c åœ¨ä¸­é—´é‚»å±…ç‚¹æ•°é‡ç»´åº¦ä¸Šå¢åŠ ä¸€ç»´ï¼Œè‡ªåŠ¨è¿›è¡Œå¹¿æ’­ï¼Œè®¡ç®—ä¸­å¿ƒç‚¹ä¸æ¯ä¸ªé‚»å±…ç‚¹ä¹‹é—´çš„ç‰¹å¾å·®å¼‚</span>
</span><span id="__span-1-90"><a id="__codelineno-1-90" name="__codelineno-1-90"></a><a href="#__codelineno-1-90"><span class="linenos" data-linenos=" 90 "></span></a>            <span class="o">+</span> <span class="n">einops</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
</span><span id="__span-1-91"><a id="__codelineno-1-91" name="__codelineno-1-91"></a><a href="#__codelineno-1-91"><span class="linenos" data-linenos=" 91 "></span></a>                <span class="n">p_r</span><span class="p">,</span> <span class="s2">"n ns (i j) -&gt; n ns j"</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">"sum"</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mid_planes</span>     <span class="c1"># n k c</span>
</span><span id="__span-1-92"><a id="__codelineno-1-92" name="__codelineno-1-92"></a><a href="#__codelineno-1-92"><span class="linenos" data-linenos=" 92 "></span></a>            <span class="p">)</span>
</span><span id="__span-1-93"><a id="__codelineno-1-93" name="__codelineno-1-93"></a><a href="#__codelineno-1-93"><span class="linenos" data-linenos=" 93 "></span></a>        <span class="p">)</span>
</span><span id="__span-1-94"><a id="__codelineno-1-94" name="__codelineno-1-94"></a><a href="#__codelineno-1-94"><span class="linenos" data-linenos=" 94 "></span></a>        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_w</span><span class="p">(</span><span class="n">r_qk</span><span class="p">)</span>  <span class="c1"># (n, nsample, c/s)</span>
</span><span id="__span-1-95"><a id="__codelineno-1-95" name="__codelineno-1-95"></a><a href="#__codelineno-1-95"><span class="linenos" data-linenos=" 95 "></span></a>        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span id="__span-1-96"><a id="__codelineno-1-96" name="__codelineno-1-96"></a><a href="#__codelineno-1-96"><span class="linenos" data-linenos=" 96 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
</span><span id="__span-1-97"><a id="__codelineno-1-97" name="__codelineno-1-97"></a><a href="#__codelineno-1-97"><span class="linenos" data-linenos=" 97 "></span></a>            <span class="s2">"n t s i, n t i -&gt; n s i"</span><span class="p">,</span>
</span><span id="__span-1-98"><a id="__codelineno-1-98" name="__codelineno-1-98"></a><a href="#__codelineno-1-98"><span class="linenos" data-linenos=" 98 "></span></a>            <span class="n">einops</span><span class="o">.</span><span class="n">rearrange</span><span class="p">(</span><span class="n">x_v</span> <span class="o">+</span> <span class="n">p_r</span><span class="p">,</span> <span class="s2">"n ns (s i) -&gt; n ns s i"</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">share_planes</span><span class="p">),</span>     <span class="c1"># n k s c/s</span>
</span><span id="__span-1-99"><a id="__codelineno-1-99" name="__codelineno-1-99"></a><a href="#__codelineno-1-99"><span class="linenos" data-linenos=" 99 "></span></a>            <span class="n">w</span><span class="p">,</span>  <span class="c1"># n k c/s è‡ªåŠ¨å¹¿æ’­ åˆ° n k s c/s ï¼Œç›¸å½“äºæŠŠç‰¹å¾åˆ†ä¸ºsä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†çš„æƒé‡ä¸åŒï¼Œç»„å†…æƒé‡å…±äº«</span>
</span><span id="__span-1-100"><a id="__codelineno-1-100" name="__codelineno-1-100"></a><a href="#__codelineno-1-100"><span class="linenos" data-linenos="100 "></span></a>        <span class="p">)</span>
</span><span id="__span-1-101"><a id="__codelineno-1-101" name="__codelineno-1-101"></a><a href="#__codelineno-1-101"><span class="linenos" data-linenos="101 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">einops</span><span class="o">.</span><span class="n">rearrange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">"n s i -&gt; n (s i)"</span><span class="p">)</span>     <span class="c1"># n c</span>
</span><span id="__span-1-102"><a id="__codelineno-1-102" name="__codelineno-1-102"></a><a href="#__codelineno-1-102"><span class="linenos" data-linenos="102 "></span></a>        <span class="k">return</span> <span class="n">x</span>
</span></code></pre></div>
</details>
<h3 id="transitionup">transitionUp</h3>
<p>åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æ˜¯ä» encoder5 åˆ° decoder1 çš„è¿ç®—ï¼Œè¿™ç§æƒ…å†µä¸‹ç‚¹æ²¡æœ‰å˜å¤šï¼Œåªæ˜¯å¯¹ç‰¹å¾è¿›è¡Œäº†é‡ç»„è¿ç®—</p>
<p>å…·ä½“æ¥è¯´ï¼Œå°† encoder5 çš„è¾“å‡ºé¦–å…ˆåœ¨ç‚¹ä¸ªæ•°ç»´åº¦åšä¸€ä¸ªå…¨å±€å¹³å‡æ± åŒ–ï¼ˆä¹Ÿå°±æ˜¯å¯¹æ‰€æœ‰ç‚¹ç‰¹å¾å–å¹³å‡å€¼ï¼‰ï¼Œç„¶åä¸€ä¸ª Linear å±‚å˜æ¢ä¸€ä¸‹ï¼ˆä¸æ”¹å˜ç‰¹å¾ç»´åº¦ï¼‰ï¼Œç„¶åé‡å¤åŸå…ˆçš„ç‚¹äº‘ä¸ªæ•° cnt æ¬¡ï¼Œè¿™æ ·å˜æ¢ä¹‹åå½¢çŠ¶ä¸å‘ç”Ÿæ”¹å˜ï¼Œç„¶åå†å’ŒåŸå§‹ encoder5 çš„è¾“å‡ºåœ¨é€šé“ç»´ concat èµ·æ¥ï¼Œæ‹¼æ¥èµ·æ¥ä¹‹åå†ä½¿ç”¨ Linear æå–ä¸€æ¬¡ç‰¹å¾ï¼Œå°±å¾—åˆ° transitionUp æ¨¡å—çš„è¾“å‡ºã€‚</p>
<p>ç¬¬äºŒç§æƒ…å†µæ˜¯ decoder å±‚ä¹‹é—´çš„å˜åŒ–ï¼Œæ­¤æ—¶éœ€è¦è¿›è¡Œè·¨å±‚èåˆï¼Œå…·ä½“æ¥è¯´ï¼Œå¯¹äº decoder1 åˆ° decoder2 çš„å˜åŒ–ï¼Œdecoder1 éœ€è¦å’Œ encoder4 èåˆï¼Œdecoder1 çš„ç‚¹ç¨€ç–ï¼Œç‰¹å¾ç»´åº¦é«˜ï¼Œencoder4 çš„ç‚¹å¯†é›†ï¼Œç‰¹å¾ç»´åº¦ä½ï¼Œè¿™é‡Œå’Œ PointNet++çš„ç‰¹å¾å¹¿æ’­æœ‰ç‚¹åƒï¼Œæˆ‘ä»¬å…ˆæŠŠ decoder1 å±‚çš„é«˜ç»´ç‰¹å¾é™ä½åˆ°å’Œ encoder4 ä¸€è‡´ï¼Œç„¶åéå† encoder4 çš„æ¯ä¸€ä¸ªç‚¹ï¼Œåœ¨ decoder1 æ‰¾è·ç¦»å®ƒæœ€è¿‘çš„ k ä¸ªç‚¹ï¼Œç„¶åå¯¹è¿™ k ä¸ªç‚¹çš„ç‰¹å¾æŒ‰ç…§è·ç¦»åæ¯”åŠ æƒæ±‚å’Œï¼Œå¾—åˆ° encoder4 ä¸­è¿™ä¸ªç‚¹çš„æ–°ç‰¹å¾ï¼›å¾—åˆ° encoder4 ä¸­æ¯ä¸ªç‚¹çš„æ–°ç‰¹å¾åï¼Œå¯¹æ¯ä¸ªç‚¹åŸæ¥çš„æ—§ç‰¹å¾è¿›è¡Œçº¿æ€§å˜æ¢ï¼ˆä¸æ”¹å˜ç»´åº¦ï¼‰ï¼Œç„¶åå°†å˜æ¢åçš„æ—§ç‰¹å¾å’Œæ–°ç‰¹å¾è¿›è¡Œé€å…ƒç´ ç›¸åŠ ï¼ˆå› ä¸ºé€šé“å·²ç»å¯¹é½ï¼Œå¯ä»¥ç›¸åŠ ï¼‰ï¼Œå°±å¾—åˆ°æœ€ç»ˆè¾“å‡º</p>
<p>è¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š</p>
<details class="note">
<summary>Note</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="  1 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">TransitionUp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="  2 "></span></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="  3 "></span></a><span class="sd">    ä¸Šé‡‡æ ·å±‚ï¼Œç”¨äºå°†è¾“å…¥çš„ç‚¹äº‘ç‰¹å¾è¿›è¡Œä¸Šé‡‡æ ·</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="  4 "></span></a><span class="sd">    input: pxo1: (p, x, o)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="  5 "></span></a><span class="sd">    output: (n, x, o)</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos="  6 "></span></a><span class="sd">        Structure (Mode 1: Upsampling / Interpolation):</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos="  7 "></span></a><span class="sd">            Target (Fine)                Source (Coarse)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><a href="#__codelineno-2-8"><span class="linenos" data-linenos="  8 "></span></a><span class="sd">            (p1, x1, o1)                  (p2, x2, o2)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><a href="#__codelineno-2-9"><span class="linenos" data-linenos="  9 "></span></a><span class="sd">                |                             |</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><a href="#__codelineno-2-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="sd">                |                       [ Linear 2 ]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><a href="#__codelineno-2-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="sd">                |                             |</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><a href="#__codelineno-2-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="sd">                |                   [ Point Interpolation ]</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><a href="#__codelineno-2-13"><span class="linenos" data-linenos=" 13 "></span></a><span class="sd">                |                (Map features from p2 to p1)</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a><a href="#__codelineno-2-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="sd">                |                             |</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><a href="#__codelineno-2-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="sd">                v                             |</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a><a href="#__codelineno-2-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="sd">            [ Linear 1 ]                       |</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a><a href="#__codelineno-2-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="sd">                |                             |</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a><a href="#__codelineno-2-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="sd">                v                             v</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a><a href="#__codelineno-2-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="sd">                +------------&gt; ( + ) &lt;--------+</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a><a href="#__codelineno-2-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="sd">                                    |</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21"></a><a href="#__codelineno-2-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="sd">                                Output</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22"></a><a href="#__codelineno-2-22"><span class="linenos" data-linenos=" 22 "></span></a>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23"></a><a href="#__codelineno-2-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="sd">        Structure (Mode 2: Global Aggregation - if pxo2 is None):</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24"></a><a href="#__codelineno-2-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="sd">                    Input: x (Local Features)</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25"></a><a href="#__codelineno-2-25"><span class="linenos" data-linenos=" 25 "></span></a><span class="sd">                                |</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26"></a><a href="#__codelineno-2-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="sd">                    +-----------+-----------+</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27"></a><a href="#__codelineno-2-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="sd">                    |                       |</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28"></a><a href="#__codelineno-2-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="sd">            (Local Feats)          (Global Mean)</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29"></a><a href="#__codelineno-2-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="sd">                    |                 [ Linear 2 ]</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30"></a><a href="#__codelineno-2-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="sd">                    |                 [  Repeat  ]</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31"></a><a href="#__codelineno-2-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="sd">                    v                       v</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32"></a><a href="#__codelineno-2-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="sd">                    +---------&gt;( Concat )&lt;--+</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33"></a><a href="#__codelineno-2-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="sd">                                |</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34"></a><a href="#__codelineno-2-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="sd">                            [ Linear 1 ]</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35"></a><a href="#__codelineno-2-35"><span class="linenos" data-linenos=" 35 "></span></a><span class="sd">                                |</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36"></a><a href="#__codelineno-2-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="sd">                                Output</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37"></a><a href="#__codelineno-2-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="sd">        """</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38"></a><a href="#__codelineno-2-38"><span class="linenos" data-linenos=" 38 "></span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_planes</span><span class="p">,</span> <span class="n">out_planes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39"></a><a href="#__codelineno-2-39"><span class="linenos" data-linenos=" 39 "></span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40"></a><a href="#__codelineno-2-40"><span class="linenos" data-linenos=" 40 "></span></a>            <span class="k">if</span> <span class="n">out_planes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41"></a><a href="#__codelineno-2-41"><span class="linenos" data-linenos=" 41 "></span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42"></a><a href="#__codelineno-2-42"><span class="linenos" data-linenos=" 42 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">in_planes</span><span class="p">,</span> <span class="n">in_planes</span><span class="p">),</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43"></a><a href="#__codelineno-2-43"><span class="linenos" data-linenos=" 43 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">in_planes</span><span class="p">),</span>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44"></a><a href="#__codelineno-2-44"><span class="linenos" data-linenos=" 44 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45"></a><a href="#__codelineno-2-45"><span class="linenos" data-linenos=" 45 "></span></a>                <span class="p">)</span>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46"></a><a href="#__codelineno-2-46"><span class="linenos" data-linenos=" 46 "></span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47"></a><a href="#__codelineno-2-47"><span class="linenos" data-linenos=" 47 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_planes</span><span class="p">,</span> <span class="n">in_planes</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48"></a><a href="#__codelineno-2-48"><span class="linenos" data-linenos=" 48 "></span></a>                <span class="p">)</span>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49"></a><a href="#__codelineno-2-49"><span class="linenos" data-linenos=" 49 "></span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50"></a><a href="#__codelineno-2-50"><span class="linenos" data-linenos=" 50 "></span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51"></a><a href="#__codelineno-2-51"><span class="linenos" data-linenos=" 51 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">out_planes</span><span class="p">,</span> <span class="n">out_planes</span><span class="p">),</span>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52"></a><a href="#__codelineno-2-52"><span class="linenos" data-linenos=" 52 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">out_planes</span><span class="p">),</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53"></a><a href="#__codelineno-2-53"><span class="linenos" data-linenos=" 53 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-2-54"><a id="__codelineno-2-54" name="__codelineno-2-54"></a><a href="#__codelineno-2-54"><span class="linenos" data-linenos=" 54 "></span></a>                <span class="p">)</span>
</span><span id="__span-2-55"><a id="__codelineno-2-55" name="__codelineno-2-55"></a><a href="#__codelineno-2-55"><span class="linenos" data-linenos=" 55 "></span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
</span><span id="__span-2-56"><a id="__codelineno-2-56" name="__codelineno-2-56"></a><a href="#__codelineno-2-56"><span class="linenos" data-linenos=" 56 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_planes</span><span class="p">,</span> <span class="n">out_planes</span><span class="p">),</span>
</span><span id="__span-2-57"><a id="__codelineno-2-57" name="__codelineno-2-57"></a><a href="#__codelineno-2-57"><span class="linenos" data-linenos=" 57 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="n">out_planes</span><span class="p">),</span>
</span><span id="__span-2-58"><a id="__codelineno-2-58" name="__codelineno-2-58"></a><a href="#__codelineno-2-58"><span class="linenos" data-linenos=" 58 "></span></a>                    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-2-59"><a id="__codelineno-2-59" name="__codelineno-2-59"></a><a href="#__codelineno-2-59"><span class="linenos" data-linenos=" 59 "></span></a>                <span class="p">)</span>
</span><span id="__span-2-60"><a id="__codelineno-2-60" name="__codelineno-2-60"></a><a href="#__codelineno-2-60"><span class="linenos" data-linenos=" 60 "></span></a>
</span><span id="__span-2-61"><a id="__codelineno-2-61" name="__codelineno-2-61"></a><a href="#__codelineno-2-61"><span class="linenos" data-linenos=" 61 "></span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pxo1</span><span class="p">,</span> <span class="n">pxo2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-2-62"><a id="__codelineno-2-62" name="__codelineno-2-62"></a><a href="#__codelineno-2-62"><span class="linenos" data-linenos=" 62 "></span></a>            <span class="c1"># === æ¨¡å¼ 2ï¼šå…¨å±€ç‰¹å¾èšåˆ (å½“æ²¡æœ‰æä¾›ç¬¬äºŒä¸ªè¾“å…¥ pxo2 æ—¶) ===</span>
</span><span id="__span-2-63"><a id="__codelineno-2-63" name="__codelineno-2-63"></a><a href="#__codelineno-2-63"><span class="linenos" data-linenos=" 63 "></span></a>            <span class="c1"># è¿™é€šå¸¸å‘ç”Ÿåœ¨ Encoder åˆšç»“æŸï¼Œå‡†å¤‡è¿›å…¥ Decoder çš„æœ€æ·±å±‚ (Stage 5)</span>
</span><span id="__span-2-64"><a id="__codelineno-2-64" name="__codelineno-2-64"></a><a href="#__codelineno-2-64"><span class="linenos" data-linenos=" 64 "></span></a>            <span class="k">if</span> <span class="n">pxo2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-65"><a id="__codelineno-2-65" name="__codelineno-2-65"></a><a href="#__codelineno-2-65"><span class="linenos" data-linenos=" 65 "></span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="n">pxo1</span>  <span class="c1"># (n, 3), (n, c), (b)</span>
</span><span id="__span-2-66"><a id="__codelineno-2-66" name="__codelineno-2-66"></a><a href="#__codelineno-2-66"><span class="linenos" data-linenos=" 66 "></span></a>                <span class="n">x_tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-67"><a id="__codelineno-2-67" name="__codelineno-2-67"></a><a href="#__codelineno-2-67"><span class="linenos" data-linenos=" 67 "></span></a>                <span class="c1"># éå† Batch ä¸­çš„æ¯ä¸€ä¸ªæ ·æœ¬ï¼ˆç‚¹äº‘ï¼‰</span>
</span><span id="__span-2-68"><a id="__codelineno-2-68" name="__codelineno-2-68"></a><a href="#__codelineno-2-68"><span class="linenos" data-linenos=" 68 "></span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-2-69"><a id="__codelineno-2-69" name="__codelineno-2-69"></a><a href="#__codelineno-2-69"><span class="linenos" data-linenos=" 69 "></span></a>                    <span class="c1"># è®¡ç®—å½“å‰æ ·æœ¬åœ¨ packed Tensor ä¸­çš„èµ·å§‹ç´¢å¼• s_i å’Œç»“æŸç´¢å¼• e_iï¼Œä»¥åŠç‚¹æ•° cnt</span>
</span><span id="__span-2-70"><a id="__codelineno-2-70" name="__codelineno-2-70"></a><a href="#__codelineno-2-70"><span class="linenos" data-linenos=" 70 "></span></a>                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-2-71"><a id="__codelineno-2-71" name="__codelineno-2-71"></a><a href="#__codelineno-2-71"><span class="linenos" data-linenos=" 71 "></span></a>                        <span class="n">s_i</span><span class="p">,</span> <span class="n">e_i</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-2-72"><a id="__codelineno-2-72" name="__codelineno-2-72"></a><a href="#__codelineno-2-72"><span class="linenos" data-linenos=" 72 "></span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-73"><a id="__codelineno-2-73" name="__codelineno-2-73"></a><a href="#__codelineno-2-73"><span class="linenos" data-linenos=" 73 "></span></a>                        <span class="n">s_i</span><span class="p">,</span> <span class="n">e_i</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-2-74"><a id="__codelineno-2-74" name="__codelineno-2-74"></a><a href="#__codelineno-2-74"><span class="linenos" data-linenos=" 74 "></span></a>                    <span class="c1"># å–å‡ºå½“å‰æ ·æœ¬çš„æ‰€æœ‰ç‚¹ç‰¹å¾</span>
</span><span id="__span-2-75"><a id="__codelineno-2-75" name="__codelineno-2-75"></a><a href="#__codelineno-2-75"><span class="linenos" data-linenos=" 75 "></span></a>                    <span class="n">x_b</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">s_i</span><span class="p">:</span><span class="n">e_i</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="__span-2-76"><a id="__codelineno-2-76" name="__codelineno-2-76"></a><a href="#__codelineno-2-76"><span class="linenos" data-linenos=" 76 "></span></a>                    <span class="c1"># [æ ¸å¿ƒæ“ä½œ]ï¼š</span>
</span><span id="__span-2-77"><a id="__codelineno-2-77" name="__codelineno-2-77"></a><a href="#__codelineno-2-77"><span class="linenos" data-linenos=" 77 "></span></a>                    <span class="c1"># 1. x_b.sum(0, True) / cnt: è®¡ç®—å½“å‰æ ·æœ¬æ‰€æœ‰ç‚¹çš„å¹³å‡å€¼ï¼ˆGlobal Mean Poolingï¼‰</span>
</span><span id="__span-2-78"><a id="__codelineno-2-78" name="__codelineno-2-78"></a><a href="#__codelineno-2-78"><span class="linenos" data-linenos=" 78 "></span></a>                    <span class="c1"># 2. self.linear2(...): å¯¹å…¨å±€ç‰¹å¾è¿›è¡Œå˜æ¢</span>
</span><span id="__span-2-79"><a id="__codelineno-2-79" name="__codelineno-2-79"></a><a href="#__codelineno-2-79"><span class="linenos" data-linenos=" 79 "></span></a>                    <span class="c1"># 3. .repeat(cnt, 1): å°†å…¨å±€ç‰¹å¾å¤åˆ¶ cnt æ¬¡ï¼Œä½¿å…¶ä¸ç‚¹æ•°å¯¹é½</span>
</span><span id="__span-2-80"><a id="__codelineno-2-80" name="__codelineno-2-80"></a><a href="#__codelineno-2-80"><span class="linenos" data-linenos=" 80 "></span></a>                    <span class="c1"># 4. torch.cat((x_b, ...), 1): å°† åŸå§‹å±€éƒ¨ç‰¹å¾ ä¸ å…¨å±€ç‰¹å¾ æ‹¼æ¥</span>
</span><span id="__span-2-81"><a id="__codelineno-2-81" name="__codelineno-2-81"></a><a href="#__codelineno-2-81"><span class="linenos" data-linenos=" 81 "></span></a>                    <span class="n">x_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span>
</span><span id="__span-2-82"><a id="__codelineno-2-82" name="__codelineno-2-82"></a><a href="#__codelineno-2-82"><span class="linenos" data-linenos=" 82 "></span></a>                        <span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span><span class="p">(</span><span class="n">x_b</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">cnt</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">1</span>
</span><span id="__span-2-83"><a id="__codelineno-2-83" name="__codelineno-2-83"></a><a href="#__codelineno-2-83"><span class="linenos" data-linenos=" 83 "></span></a>                    <span class="p">)</span>
</span><span id="__span-2-84"><a id="__codelineno-2-84" name="__codelineno-2-84"></a><a href="#__codelineno-2-84"><span class="linenos" data-linenos=" 84 "></span></a>                    <span class="n">x_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_b</span><span class="p">)</span>   <span class="c1"># (cnt,c)-&gt;(c)-&gt;(c_new)-&gt;(cnt,c_new)</span>
</span><span id="__span-2-85"><a id="__codelineno-2-85" name="__codelineno-2-85"></a><a href="#__codelineno-2-85"><span class="linenos" data-linenos=" 85 "></span></a>                <span class="c1"># å°†å¤„ç†å®Œçš„ batch é‡æ–°æ‹¼å›ä¸€ä¸ªå¤§ Tensor</span>
</span><span id="__span-2-86"><a id="__codelineno-2-86" name="__codelineno-2-86"></a><a href="#__codelineno-2-86"><span class="linenos" data-linenos=" 86 "></span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-2-87"><a id="__codelineno-2-87" name="__codelineno-2-87"></a><a href="#__codelineno-2-87"><span class="linenos" data-linenos=" 87 "></span></a>                <span class="c1"># é€šè¿‡ linear1 èåˆæ‹¼æ¥åçš„ç‰¹å¾</span>
</span><span id="__span-2-88"><a id="__codelineno-2-88" name="__codelineno-2-88"></a><a href="#__codelineno-2-88"><span class="linenos" data-linenos=" 88 "></span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-2-89"><a id="__codelineno-2-89" name="__codelineno-2-89"></a><a href="#__codelineno-2-89"><span class="linenos" data-linenos=" 89 "></span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-90"><a id="__codelineno-2-90" name="__codelineno-2-90"></a><a href="#__codelineno-2-90"><span class="linenos" data-linenos=" 90 "></span></a>                <span class="c1"># === æ¨¡å¼ 1ï¼šä¸Šé‡‡æ ·ä¸èåˆ (æ ‡å‡†ç”¨æ³•) ===</span>
</span><span id="__span-2-91"><a id="__codelineno-2-91" name="__codelineno-2-91"></a><a href="#__codelineno-2-91"><span class="linenos" data-linenos=" 91 "></span></a>                <span class="c1"># pxo1: Target (Fine)ï¼Œæ¥è‡ª Encoder çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾ï¼ˆè·³è·ƒè¿æ¥ï¼‰ï¼Œp1æ˜¯å¯†é›†ç‚¹äº‘ï¼Œx1æ˜¯ä½ç»´ç‰¹å¾</span>
</span><span id="__span-2-92"><a id="__codelineno-2-92" name="__codelineno-2-92"></a><a href="#__codelineno-2-92"><span class="linenos" data-linenos=" 92 "></span></a>                <span class="n">p1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">o1</span> <span class="o">=</span> <span class="n">pxo1</span>
</span><span id="__span-2-93"><a id="__codelineno-2-93" name="__codelineno-2-93"></a><a href="#__codelineno-2-93"><span class="linenos" data-linenos=" 93 "></span></a>                <span class="c1"># pxo2: Source (Coarse)ï¼Œæ¥è‡ªä¸Šä¸€å±‚ Decoder çš„ä½åˆ†è¾¨ç‡ç‰¹å¾ï¼Œp2æ˜¯ç¨€ç–ç‚¹äº‘ï¼Œx2æ˜¯é«˜ç»´ç‰¹å¾</span>
</span><span id="__span-2-94"><a id="__codelineno-2-94" name="__codelineno-2-94"></a><a href="#__codelineno-2-94"><span class="linenos" data-linenos=" 94 "></span></a>                <span class="n">p2</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">o2</span> <span class="o">=</span> <span class="n">pxo2</span>
</span><span id="__span-2-95"><a id="__codelineno-2-95" name="__codelineno-2-95"></a><a href="#__codelineno-2-95"><span class="linenos" data-linenos=" 95 "></span></a>
</span><span id="__span-2-96"><a id="__codelineno-2-96" name="__codelineno-2-96"></a><a href="#__codelineno-2-96"><span class="linenos" data-linenos=" 96 "></span></a>                <span class="c1"># [æ ¸å¿ƒæ“ä½œ]ï¼šä¸Šé‡‡æ · (Interpolation) + èåˆ (Summation)</span>
</span><span id="__span-2-97"><a id="__codelineno-2-97" name="__codelineno-2-97"></a><a href="#__codelineno-2-97"><span class="linenos" data-linenos=" 97 "></span></a>                <span class="c1"># 1. self.linear2(x2): å…ˆå˜æ¢æˆä½ç»´ç‰¹å¾</span>
</span><span id="__span-2-98"><a id="__codelineno-2-98" name="__codelineno-2-98"></a><a href="#__codelineno-2-98"><span class="linenos" data-linenos=" 98 "></span></a>                <span class="c1"># 2. pointops.interpolation(...): </span>
</span><span id="__span-2-99"><a id="__codelineno-2-99" name="__codelineno-2-99"></a><a href="#__codelineno-2-99"><span class="linenos" data-linenos=" 99 "></span></a>                <span class="c1">#    åœ¨ p1 (å¯†é›†ç‚¹äº‘) ä¸­å¯»æ‰¾ p2 (ç¨€ç–ç‚¹äº‘) çš„æœ€è¿‘é‚»ï¼Œåˆ©ç”¨è·ç¦»æƒé‡å°† x2 æ’å€¼æ˜ å°„åˆ° p1 çš„ä½ç½®ã€‚</span>
</span><span id="__span-2-100"><a id="__codelineno-2-100" name="__codelineno-2-100"></a><a href="#__codelineno-2-100"><span class="linenos" data-linenos="100 "></span></a>                <span class="c1">#    è¿™ä¸€æ­¥å°†æ·±å±‚çš„ç‰¹å¾ä¼ æ’­åˆ°äº†å¯†é›†çš„ç‚¹äº‘åæ ‡ä¸Š</span>
</span><span id="__span-2-101"><a id="__codelineno-2-101" name="__codelineno-2-101"></a><a href="#__codelineno-2-101"><span class="linenos" data-linenos="101 "></span></a>                <span class="c1"># 3. self.linear1(x1): ä½ç»´ç‰¹å¾ä¹Ÿå˜åŒ–ä¸€ä¸‹ï¼Œæå–ç‰¹å¾</span>
</span><span id="__span-2-102"><a id="__codelineno-2-102" name="__codelineno-2-102"></a><a href="#__codelineno-2-102"><span class="linenos" data-linenos="102 "></span></a>                <span class="c1"># 4. + : å°† æ’å€¼åçš„æ·±å±‚ç‰¹å¾ ä¸ æµ…å±‚ç»†èŠ‚ç‰¹å¾ ç›¸åŠ èåˆ</span>
</span><span id="__span-2-103"><a id="__codelineno-2-103" name="__codelineno-2-103"></a><a href="#__codelineno-2-103"><span class="linenos" data-linenos="103 "></span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">pointops</span><span class="o">.</span><span class="n">interpolation</span><span class="p">(</span>
</span><span id="__span-2-104"><a id="__codelineno-2-104" name="__codelineno-2-104"></a><a href="#__codelineno-2-104"><span class="linenos" data-linenos="104 "></span></a>                    <span class="n">p2</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o1</span>
</span><span id="__span-2-105"><a id="__codelineno-2-105" name="__codelineno-2-105"></a><a href="#__codelineno-2-105"><span class="linenos" data-linenos="105 "></span></a>                <span class="p">)</span>   <span class="c1"># å’ŒPointNet++çš„æ‰¾é‚»å±…ä¸€æ ·ï¼Œå¯¹å¯†é›†ç‚¹äº‘ä¸­çš„æ¯ä¸€ä¸ªç‚¹ï¼Œåœ¨ç¨€ç–ç‚¹äº‘ä¸­å¯»æ‰¾æœ€è¿‘çš„kä¸ªç‚¹ï¼Œæƒé‡ä¾ç„¶æ˜¯æ ¹æ®è·ç¦»åæ¯”è·å¾—ï¼Œç„¶åå¯¹ç¨€ç–ç‚¹äº‘ï¼ˆé«˜ç»´ç‰¹å¾ï¼‰è¿›è¡ŒåŠ æƒæ±‚å’Œ</span>
</span><span id="__span-2-106"><a id="__codelineno-2-106" name="__codelineno-2-106"></a><a href="#__codelineno-2-106"><span class="linenos" data-linenos="106 "></span></a>                <span class="c1"># ä¸åŒä¹‹å¤„åœ¨äºï¼ŒPointNet++å°†æ’å€¼å¾—åˆ°çš„é«˜ç»´ç‰¹å¾å’ŒåŸæ¥å¯†é›†ç‚¹äº‘çš„ä½ç»´ç‰¹å¾ç›´æ¥åœ¨é€šé“ç»´åº¦æ‹¼æ¥ï¼Œä½†æ˜¯ptv1æ˜¯å…ˆå°†é«˜ç»´ç‰¹å¾é™ç»´ï¼ˆå’Œå¯†é›†ç‚¹äº‘ä¸­çš„ä½ç»´ç‰¹å¾ç»´åº¦ä¸€è‡´ï¼‰ï¼Œ</span>
</span><span id="__span-2-107"><a id="__codelineno-2-107" name="__codelineno-2-107"></a><a href="#__codelineno-2-107"><span class="linenos" data-linenos="107 "></span></a>                <span class="c1"># ç„¶ååœ¨å¯†é›†ç‚¹äº‘ä¸­å¯»æ‰¾ç¨€ç–ç‚¹äº‘çš„é‚»å±…ï¼Œåˆ©ç”¨è·ç¦»æƒé‡å°†é«˜é™ç»´åçš„ç‰¹å¾æ’å€¼æ˜ å°„åˆ°å¯†é›†ç‚¹äº‘çš„ä½ç½®ï¼Œæœ€åå°†å¯†é›†ç‚¹äº‘çš„æ–°ç‰¹å¾å’Œæ—§ç‰¹å¾ç›´æ¥é€å…ƒç´ ç›¸åŠ </span>
</span><span id="__span-2-108"><a id="__codelineno-2-108" name="__codelineno-2-108"></a><a href="#__codelineno-2-108"><span class="linenos" data-linenos="108 "></span></a>            <span class="k">return</span> <span class="n">x</span>
</span></code></pre></div>
</details>
<p>ä»¥ä¸Šå°±æ˜¯ ptv1 æ‰€æœ‰ä¸»è¦æ¨¡å—çš„è§£è¯»äº†ï¼Œå¦‚æœç”¨äºåˆ†ç±»ä»»åŠ¡ï¼Œåˆ™ä¸éœ€è¦ decoder æ¨¡å—ï¼Œç›´æ¥å°† encoder5 çš„è¾“å‡ºç‰¹å¾å¹³å‡æ± åŒ–ï¼Œå†åŠ ä¸Šä¸€ä¸ªåˆ†ç±» MLP å¤´å°±å¯ä»¥äº†ã€‚å¦‚æœæ˜¯åˆ†å‰²ä»»åŠ¡ï¼Œåˆ™éœ€è¦ decoder æ¨¡å—ï¼Œå°†ä¸‹é‡‡æ ·å¤±å»çš„ç‚¹ï¼Œé€šè¿‡ transitionUp æ¨¡å—é€æ­¥æ·»åŠ å›æ¥ï¼Œæ¢å¤ç‚¹æ•°åï¼Œå†åˆ©ç”¨æ¯ä¸ªç‚¹çš„ç‰¹å¾è¿›è¡Œé€ç‚¹åˆ†ç±»ï¼Œè¿™å°±æ˜¯åˆ†å‰²ä»»åŠ¡ã€‚</p>
<h2 id="ptv2">PTv2</h2>
<p>è®ºæ–‡æ ‡é¢˜ä¸ºï¼šPoint Transformer V2: Grouped Vector Attention and Partion-based Pooling</p>
<p>å…³é”®è¯ï¼šåˆ†ç»„å‘é‡æ³¨æ„åŠ›ï¼ˆGrouped Vector Attenionï¼‰ã€åˆ†åŒºæ± åŒ–ï¼ˆPartion-based Poolingï¼‰ã€æ›´å¼ºçš„ä½ç½®ç¼–ç </p>
<h3 id="_2">èƒŒæ™¯</h3>
<p>PTv1 è™½ç„¶æ•ˆæœå¥½ï¼Œä½†å­˜åœ¨æ•ˆç‡å’Œå‚æ•°é‡çš„ç¼ºé™·ï¼Œå…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li>å‚æ•°è¿‡æ‹Ÿåˆä¸æ·±åº¦é™åˆ¶ã€‚PTv1 çš„å‘é‡æ³¨æ„åŠ›ä½¿ç”¨å…¨è¿æ¥å±‚æ¥ç”Ÿæˆæƒé‡ï¼Œéšç€é€šé“æ•°å¢åŠ ï¼Œå‚æ•°é‡å‰§å¢ï¼Œå¯¼è‡´è¿‡æ‹Ÿåˆï¼Œé™åˆ¶äº†ç½‘ç»œæ·±åº¦ï¼›</li>
<li>æ± åŒ–æ•ˆç‡ä½ã€‚PTv1 ä½¿ç”¨çš„ FPS+KNN é‡‡æ ·æ–¹å¼ï¼Œæ—¢è€—æ—¶ï¼Œåˆå¯¼è‡´ç©ºé—´å¯¹é½ä¸ä½³ï¼ˆé‚»åŸŸé‡å ä¸å¯æ§ï¼‰ï¼›</li>
<li>ä½ç½®ä¿¡æ¯åˆ©ç”¨ä¸è¶³ã€‚ä»¥å‰çš„æ–¹æ³•æ²¡æœ‰å……åˆ†åˆ©ç”¨ 3D åæ ‡ä¸­çš„å‡ ä½•çŸ¥è¯†ã€‚</li>
</ol>
<p>æ•´ä½“æ¶æ„</p>
<p>ptv2 çš„æ•´ä½“æ¶æ„å’Œ ptv1 å·®ä¸å¤šï¼Œéƒ½æ˜¯åŸºäº U-Net çš„ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼Œåªæ˜¯åœ¨å‘é‡æ³¨æ„åŠ›çš„è®¡ç®—ã€å¯å­¦ä¹ ä½ç½®ç¼–ç ä¸Šçš„åˆ©ç”¨ã€ä»¥åŠæ± åŒ–æ–¹å¼ç­‰æ–¹é¢ï¼Œåšäº†ä¼˜åŒ–ï¼Œæ‰€ä»¥è®ºæ–‡ä¸­æ²¡æœ‰ç»˜åˆ¶æ•´ä½“ç½‘ç»œæ¶æ„å›¾ã€‚</p>
<h3 id="grouped-vector-attention">Grouped Vector Attention</h3>
<p>ç¬¬ä¸€ä¸ªæ ¸å¿ƒæ”¹è¿›åœ¨äºæ³¨æ„åŠ›çš„è®¡ç®—ï¼Œä¸ºäº†è§£å†³å‚æ•°é‡çˆ†ç‚¸é—®é¢˜ï¼Œptv2 å°†ç‰¹å¾é€šé“åˆ’åˆ†ä¸ºäº† <span class="arithmatex">\(g\)</span> ä¸ªç»„ï¼ˆä½†æ˜¯è¿™ä¸€ç‚¹ pointcept åœ¨ ptv1 çš„ä»£ç ä¸­ä¹Ÿå®ç°äº†ï¼Œåœ¨ä»£ç ä¸­å°†ç‰¹å¾åˆ†ä¸ºäº† <span class="arithmatex">\(s\)</span> ç»„ï¼Œä½†æ˜¯ ptv1 åŸå§‹è®ºæ–‡ä¸­æ²¡æœ‰æåˆ°åˆ†ç»„å‘é‡æ³¨æ„åŠ›ï¼Œè€Œæ˜¯ä½¿ç”¨ MLP ä¸ºç‰¹å¾çš„æ¯ä¸€ä¸ªç»´åº¦éƒ½è®¡ç®—å•ç‹¬çš„æƒé‡ï¼Œå¯èƒ½ pointcept ä»“åº“å†™è¿™ä¸ªä»£ç çš„æ—¶å€™ ptv2 æ—©å°±å·²ç»å‡ºäº†ï¼Œå°±æŠŠè¿™ä¸ªèåˆåˆ° ptv1 çš„ä»£ç é‡Œé¢äº†ï¼‰ã€‚</p>
<p>åˆ’åˆ†ä¸º <span class="arithmatex">\(g\)</span> ä¸ªç»„åï¼ŒåŒä¸€ä¸ªç»„å†…çš„ç‰¹å¾é€šé“å…±äº«åŒä¸€ä¸ªæ³¨æ„åŠ›æƒé‡å‘é‡ï¼Œè€Œä¸æ˜¯æ¯ä¸€ä¸ªé€šé“ä¸€ä¸ªæƒé‡ï¼Œè¿™å¤§å¤§å‡å°‘äº†å‚æ•°é‡å’Œè¿‡æ‹Ÿåˆçš„é£é™©ï¼ŒåŒæ—¶ä¿ç•™äº†å‘é‡æ³¨æ„åŠ›çš„ä¼˜åŠ¿ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨è®¡ç®—åˆ†ç»„å‘é‡æ³¨æ„åŠ›çš„æ—¶å€™ï¼Œè¾“å…¥ç»™è®¡ç®—æƒé‡çš„ mlp çš„ç‰¹å¾ï¼Œä¸å†æ˜¯ <span class="arithmatex">\(\gamma(Q,K)\)</span> çš„å…¨éƒ¨ç‰¹å¾ï¼Œè€Œæ˜¯å°† <span class="arithmatex">\(\gamma(Q,K)\)</span> å’Œå€¼å‘é‡ <span class="arithmatex">\(v\)</span> ä¸€æ ·è¿›è¡Œåˆ†ç»„ï¼ˆåˆ†ä¸º <span class="arithmatex">\(g\)</span> ç»„ï¼‰ï¼Œç„¶åæ¯ä¸ªç»„å•ç‹¬ä½¿ç”¨ mlp è®¡ç®—æ³¨æ„åŠ›æƒé‡ï¼ˆè¿™ä¸€ç‚¹å’Œå¤šå¤´è‡ªæ³¨æ„åŠ›æ¯”è¾ƒåƒï¼Œè®ºæ–‡ä¸­ä¹Ÿç”»äº†å›¾ c è¿›è¡Œå¯¹æ¯”ï¼ŒåŒºåˆ«åœ¨äºè®¡ç®—æ³¨æ„åŠ›æƒé‡çš„æ–¹å¼ä¸åŒï¼Œå¤šå¤´æ³¨æ„åŠ›é€šè¿‡ <span class="arithmatex">\(\gamma(Q,K)\)</span> çš„ç‚¹ç§¯è®¡ç®—æ³¨æ„åŠ›æƒé‡ï¼‰ï¼Œå¦‚æœæ˜¯å…¨é€šé“å‘é‡æ³¨æ„åŠ›ï¼Œmlp å‚æ•°æ•°é‡å°†æ˜¯ <span class="arithmatex">\(c^2\)</span>ï¼Œå¦‚æœåˆ†ä¸º <span class="arithmatex">\(g\)</span> ç»„ï¼Œå‚æ•°æ•°é‡å°±æ˜¯ <span class="arithmatex">\((c/g)^2 \times g =c^2/g\)</span>ï¼Œå‚æ•°å‡å°‘ä¸ºåŸæ¥çš„ <span class="arithmatex">\(1/g\)</span>ï¼Œå…¼é¡¾äº†å‘é‡æ³¨æ„åŠ›çš„ä¼˜åŠ¿ä»¥åŠè®¡ç®—æ•ˆç‡ã€‚</p>
<div class="admonition tip">
<p class="admonition-title">Important</p>
<p>ä½œè€…å‘ç°ï¼Œä¸¥æ ¼é™åˆ¶â€œç»„å†…åªçœ‹ç»„å†…å‚æ•° <span class="arithmatex">\(\gamma(Q,K)\)</span>â€çš„ <code>GroupedLinear</code> å¯¹æœ€ç»ˆæ€§èƒ½çš„è´¡çŒ®å¾®ä¹å…¶å¾®ï¼Œä½†ä¼šæ‹–æ…¢é€Ÿåº¦ã€‚ç›´æ¥ç”¨ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼ˆè®©æ‰€æœ‰é€šé“é€šè¿‡çº¿æ€§ç»„åˆç”Ÿæˆ <span class="arithmatex">\(g\)</span> ä¸ªç»„çš„æƒé‡ï¼‰æ•ˆæœä¸€æ ·å¥½ï¼Œä¸”èƒ½åˆ©ç”¨ PyTorch/CUDA é«˜åº¦ä¼˜åŒ–çš„ Dense Layer ç®—å­ã€‚
<strong>ä¼˜åŠ¿</strong>ï¼š<strong>é€Ÿåº¦æ›´å¿«ï¼Œä»£ç æ›´ç®€æ´</strong>ã€‚</p>
</div>
<p></p><figure id="_figure-4"><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5Cimage-20251226194800308.png" data-desc-position="bottom"><img alt="åˆ†ç»„å‘é‡æ³¨æ„åŠ›" src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5Cimage-20251226194800308.png"></a><figcaption>Figure 4: åˆ†ç»„å‘é‡æ³¨æ„åŠ›</figcaption></figure><p></p>
<p>åŒæ ·ï¼Œè®ºæ–‡ä¸­ä¸‹é¢è¿™å¼ å›¾è¿™å¯¹æ¯”äº† ptv2 æ”¹è¿›çš„å‘é‡æ³¨æ„åŠ›è®¡ç®—æ–¹å¼å’Œæ± åŒ–æ–¹å¼å’Œ ptv1 çš„ä¸€ä¸ªå¯¹æ¯”ã€‚é¦–å…ˆï¼Œåœ¨æ³¨æ„åŠ›çš„è®¡ç®—ä¸Šï¼Œå‰é¢å·²ç»è¯´è¿‡äº†ï¼Œæå‡ºäº†åˆ†ç»„æ¥å…¼é¡¾å‘é‡æ³¨æ„åŠ›ä¼˜åŠ¿å’Œè®¡ç®—æ•ˆç‡çš„å¹³è¡¡ï¼Œä½†æ˜¯ä½ç½®ç¼–ç çš„ä½¿ç”¨ä¸Šæœ‰ä¸åŒï¼Œptv2 ä»£ç ä¸­ç»™äº†ä¸¤ç§é€‰æ‹©ï¼š</p>
<details class="note">
<summary>Note</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">reference_index</span><span class="p">):</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a>        <span class="n">query</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>       <span class="c1"># æ ¹æ®è¾“å…¥ç‰¹å¾è®¡ç®—æ³¨æ„åŠ›è®¡ç®—éœ€è¦çš„Qã€Kã€V</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">linear_q</span><span class="p">(</span><span class="n">feat</span><span class="p">),</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">linear_k</span><span class="p">(</span><span class="n">feat</span><span class="p">),</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">linear_v</span><span class="p">(</span><span class="n">feat</span><span class="p">),</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="p">)</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">key</span> <span class="o">=</span> <span class="n">pointops</span><span class="o">.</span><span class="n">grouping</span><span class="p">(</span><span class="n">reference_index</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">with_xyz</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>         <span class="c1"># æ ¹æ®é‚»åŸŸç´¢å¼•è·å–æ³¨æ„åŠ›èŒƒå›´å†…æ‰€æœ‰ç‚¹çš„Kï¼ŒKçš„å‰ä¸‰ç»´æ˜¯åæ ‡å·®</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">pointops</span><span class="o">.</span><span class="n">grouping</span><span class="p">(</span><span class="n">reference_index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">with_xyz</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>    <span class="c1"># æ ¹æ®é‚»åŸŸç´¢å¼•è·å–æ³¨æ„åŠ›èŒƒå›´å†…æ‰€æœ‰ç‚¹çš„V</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">pos</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">key</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">:]</span>    <span class="c1"># ä»Kä¸­åˆ†ç¦»å‡ºåæ ‡å·®å’ŒçœŸæ­£çš„K</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">relation_qk</span> <span class="o">=</span> <span class="n">key</span> <span class="o">-</span> <span class="n">query</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>      <span class="c1"># è®¡ç®—r(Q,K)ï¼Œè¿™é‡Œæ˜¯å·®è¿ç®—</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_multiplier</span><span class="p">:</span>  <span class="c1"># ä½ç½®ç¼–ç ä¹˜å­æ³•</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="n">pem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_p_multiplier</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="c1"># å¯¹åæ ‡å·®è¿›è¡Œçº¿æ€§å˜æ¢</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a><a href="#__codelineno-3-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="n">relation_qk</span> <span class="o">=</span> <span class="n">relation_qk</span> <span class="o">*</span> <span class="n">pem</span>     <span class="c1"># r(Q,K) * pem</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a><a href="#__codelineno-3-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_bias</span><span class="p">:</span>        <span class="c1"># ä½ç½®ç¼–ç åç½®æ³•</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><a href="#__codelineno-3-15"><span class="linenos" data-linenos="15 "></span></a>            <span class="n">peb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_p_bias</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a><a href="#__codelineno-3-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="n">relation_qk</span> <span class="o">=</span> <span class="n">relation_qk</span> <span class="o">+</span> <span class="n">peb</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a><a href="#__codelineno-3-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="n">peb</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><a href="#__codelineno-3-18"><span class="linenos" data-linenos="18 "></span></a>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a><a href="#__codelineno-3-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_encoding</span><span class="p">(</span><span class="n">relation_qk</span><span class="p">)</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20"></a><a href="#__codelineno-3-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn_drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">weight</span><span class="p">))</span>
</span></code></pre></div>
</details>
<p>ä¸€ç§æ˜¯ä½ç½®ç¼–ç ä¹˜å­æ³•ï¼ˆå’Œ ptv1 ä¸€æ ·ï¼Œè®¡ç®—æ³¨æ„åŠ›çš„æ—¶å€™ä½¿ç”¨ KNN æŸ¥è¯¢é‚»åŸŸç‚¹ï¼Œç„¶åè®¡ç®—åæ ‡å·®ã€æ³¨æ„åŠ›æƒé‡ç­‰ï¼‰ï¼Œå…·ä½“æ¥è¯´ï¼Œå°†åæ ‡å·® pos è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå˜æ¢åˆ°å’Œç‰¹å¾ç»´åº¦ä¸€è‡´ï¼Œç„¶åå’Œ <span class="arithmatex">\(\gamma(Q,K)\)</span> è¿›è¡Œé€å…ƒç´ ä¹˜ç§¯ï¼Œå°†ç»“æœé€å…¥åˆ°è®¡ç®—æ³¨æ„åŠ›æƒé‡çš„ mlp å±‚ï¼Œå¾—åˆ°æ³¨æ„åŠ›æƒé‡ï¼Œå€¼å‘é‡ value ä¸å˜ï¼Œæ²¡æœ‰åŠ ä½ç½®ç¼–ç ï¼›å³</p>
<div class="arithmatex">\[
w =\omega(\gamma(K, Q)\odot Linear(\Delta pos))
\]</div>
<p>å¦ä¸€ç§æ˜¯ä½ç½®ç¼–ç åç½®æ³•ï¼Œå…·ä½“æ¥è¯´ï¼Œå…ˆæŠŠåæ ‡å·® pos è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå˜æ¢åˆ°å’Œç‰¹å¾ç»´åº¦ä¸€è‡´ï¼Œç„¶åå’Œ <span class="arithmatex">\(\gamma(Q,K)\)</span> è¿›è¡Œç›¸åŠ ï¼Œå°†ç›¸åŠ çš„ç»“æœé€å…¥åˆ°è®¡ç®—æ³¨æ„åŠ›æƒé‡çš„ mlp å±‚ï¼Œå¾—åˆ°æ³¨æ„åŠ›æƒé‡ï¼ŒåŒæ—¶å€¼å‘é‡ value ä¹ŸåŠ ä¸Šå˜æ¢åçš„åæ ‡ç¼–ç ï¼Œå¯¹å˜åŒ–åçš„å€¼å‘é‡è¿›è¡ŒåŠ æƒæ±‚å’Œï¼›å³</p>
<div class="arithmatex">\[
w =\omega(\gamma(Q, K)+Linear(\Delta pos)), \quad y = w(value+Linear(\Delta pos))
\]</div>
<p>è¿™ä¸€ç‚¹ä»£ç ä¸­çš„å®ç°å’Œè®ºæ–‡ä¸­è²Œä¼¼æœ‰ç‚¹ä¸ä¸€è‡´ï¼Œè®ºæ–‡ä¸­å›¾ç¤ºçš„æ•ˆæœæ„Ÿè§‰åº”è¯¥æ˜¯ä¸‹é¢è¿™ç§ï¼š</p>
<div class="arithmatex">\[
w =\omega(Linear(\Delta pos)\odot\gamma(Q, K)+Linear(\Delta pos))
\]</div>
<p>ç„¶åå€¼å‘é‡ä¿æŒä¸å˜ã€‚</p>
<p></p><figure id="_figure-5"><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5Cimage-20251226195426222.png" data-desc-position="bottom"><img alt="ptv2 å’Œ v1 åœ¨å‘é‡æ³¨æ„åŠ›ã€æ± åŒ–æ–¹å¼ä¸Šçš„å¯¹æ¯”" src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C12%5Cimage-20251226195426222.png"></a><figcaption>Figure 5: ptv2 å’Œ v1 åœ¨å‘é‡æ³¨æ„åŠ›ã€æ± åŒ–æ–¹å¼ä¸Šçš„å¯¹æ¯”</figcaption></figure><p></p>
<p>ç„¶åæ˜¯æ± åŒ–æ–¹å¼ä¸Šçš„æ”¹è¿›ï¼Œå‰é¢è¯´è¿‡ï¼Œptv1 ä½¿ç”¨ FPS å’Œ KNN è¿›è¡Œä¸‹é‡‡æ ·æ± åŒ–ï¼Œæ‰¾é‚»å±…ï¼Œèšåˆé‚»å±…ç‰¹å¾ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•çš„æŸ¥è¯¢é›†åœ¨ç©ºé—´ä¸Šä¸å¯¹é½ï¼Œä¸”ä¸åŒæŸ¥è¯¢é›†ä¹‹é—´çš„é‡å åŒºåŸŸä¸å¯æ§ï¼Œè¿™å¯¼è‡´è®¡ç®—æ•ˆç‡ä½ä¸”æ˜¾å­˜å ç”¨é«˜ã€‚å› æ­¤ ptv2 ä½¿ç”¨äº†åŸºäºåŒºåŸŸåˆ’åˆ†çš„æ± åŒ–ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œptv1 çš„æ± åŒ–å’Œåæ± åŒ–éƒ½è¦é€šè¿‡ KNN æŸ¥è¯¢æœ€è¿‘ç‚¹ï¼Œä½†æ˜¯ ptv2 é€šè¿‡å°†ç‚¹äº‘ç©ºé—´åˆ‡å‰²æˆäº’ä¸é‡å çš„åˆ†åŒºï¼ˆæ¯”å¦‚å‡åŒ€ç½‘æ ¼ï¼Œå³ Grid Poolingï¼‰</p>
<p><strong>æ“ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li><strong>åˆ’åˆ†ï¼ˆPartitionï¼‰ï¼š</strong> å°†æ•´ä¸ªç‚¹äº‘ç©ºé—´ <span class="arithmatex">\(\mathcal{M}\)</span> åˆ‡å‰²æˆå¤šä¸ªäº’ä¸é‡å çš„å­é›† <span class="arithmatex">\([\mathcal{M}_1, \mathcal{M}_2, ..., \mathcal{M}_{n'}]\)</span>ã€‚å°±åƒæŠŠä¸€ä¸ªå¤§ç›’å­åˆ‡æˆå¾ˆå¤šå°æ–¹å—ï¼ˆGridï¼‰ã€‚</li>
<li><strong>èåˆï¼ˆFusionï¼‰ï¼š</strong> å¯¹æ¯ä¸€ä¸ªå°æ–¹å—å†…çš„æ‰€æœ‰ç‚¹è¿›è¡Œèšåˆï¼Œç”Ÿæˆ <strong>ä¸€ä¸ª</strong> æ–°çš„ä»£è¡¨ç‚¹ï¼ˆPooling Pointï¼‰ã€‚</li>
</ol>
<p>å…·ä½“æ¥è¯´ï¼Œå¯¹å°æ–¹å—å†…æ‰€æœ‰ç‚¹ç‰¹å¾è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œç„¶åå¯¹æ¯ä¸€ä¸ªæ ·æœ¬ç‚¹äº‘è¿›è¡Œç½‘æ ¼åˆ’åˆ†ï¼ŒåŒä¸€ä¸ªç½‘æ ¼ä¸­ç‚¹çš„åæ ‡é‡‡ç”¨å¹³å‡æ± åŒ–ï¼Œç”¨ç½‘æ ¼å†…æ‰€æœ‰ç‚¹çš„è´¨å¿ƒåšä»£è¡¨ï¼›åŒä¸€ä¸ªç½‘æ ¼ä¸­ç‚¹çš„ç‰¹å¾é‡‡ç”¨æœ€å¤§æ± åŒ–ï¼Œæ¯ä¸€ç»´ç‰¹å¾é€‰æ‹©æ‰€æœ‰ç‚¹ä¸­å€¼æœ€å¤§çš„ä½œä¸ºä»£è¡¨ï¼Œä» <span class="arithmatex">\((n,c)\)</span> åˆ° <span class="arithmatex">\((c)\)</span>ã€‚</p>
<h2 id="ptv3">PTv3</h2>
<p>è®ºæ–‡æ ‡é¢˜ä¸ºï¼šPoint Transformer V3: Simpler, Faster, Stronger</p>
<p>å…³é”®è¯ï¼šåºåˆ—åŒ–ï¼ˆSerializationï¼‰ã€æ•ˆç‡ä¼˜å…ˆï¼ˆSimpler, Faster, Strongerï¼‰ã€æ‰©å¤§æ„Ÿå—é‡ã€å¤šæ•°æ®é›†è”åˆè®­ç»ƒã€‚</p>
<h3 id="_3">èƒŒæ™¯</h3>
<p>3D éª¨å¹²ç½‘ç»œçš„å‘å±•å—é™äºâ€œæ•°æ®è§„æ¨¡â€å’Œâ€œæ„Ÿå—é‡è§„æ¨¡â€ï¼Œä»¥å¾€çš„æ¨¡å‹ï¼ˆå¦‚ PTv2ï¼‰ä¸ºäº†è¿½æ±‚å±€éƒ¨ç»“æ„çš„ç²¾ç¡®æ€§ï¼ˆæ¯”å¦‚è®¡ç®—æ³¨æ„åŠ›çš„æ—¶å€™ï¼Œä¾ç„¶ä½¿ç”¨ KNN æŸ¥è¯¢è·å–é‚»å±…ç‚¹ï¼‰ï¼Œç‰ºç‰²äº†å¤ªå¤šæ•ˆç‡ã€‚</p>
<p>åŒæ—¶ï¼Œä½œè€…å‘ç° PTv2 å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ•ˆç‡ç“¶é¢ˆï¼š</strong> KNN æŸ¥è¯¢å æ®äº† 28%çš„æ¨ç†æ—¶é—´ï¼Œå¤æ‚çš„ç›¸å¯¹ä½ç½®ç¼–ç ï¼ˆRPEï¼‰å æ®äº† 26%çš„æ—¶é—´ã€‚è¿™äº›æ“ä½œä¸ä»…æ…¢ï¼Œè¿˜å†…å­˜æ¶ˆè€—å¤§ï¼Œå¯¼è‡´æ— æ³•æ‰©å±•æ„Ÿå—é‡ ï¼›</li>
<li><strong>æ„Ÿå—é‡å—é™ï¼š</strong> ä¸ºäº†ä¿æŒæ•ˆç‡ï¼ŒPTv2 çš„æ„Ÿå—é‡åªèƒ½é™åˆ¶åœ¨ 16 ä¸ªç‚¹å·¦å³ï¼Œé™åˆ¶äº†é•¿è·ç¦»ä¸Šä¸‹æ–‡çš„è·å– ï¼›</li>
<li><strong>æ— åºæ€§å¸¦æ¥çš„å›°éš¾ï¼š</strong> ç‚¹äº‘çš„æ— åºæ€§ï¼ˆPermutation Invarianceï¼‰ä½¿å¾—åƒå›¾åƒé‚£æ ·é«˜æ•ˆå¤„ç†å˜å¾—å›°éš¾ï¼›</li>
</ol>
<p><mark>æ ¸å¿ƒåˆ›æ–°ä¸ç½‘ç»œæ¶æ„</mark></p>
<p>1ã€ç‚¹äº‘åºåˆ—åŒ–ï¼ˆPoint Cloud Serializationï¼‰</p>
<ul>
<li>æ”¾å¼ƒæ— åºé›†åˆçš„æ‰§å¿µï¼Œé€šè¿‡ç©ºé—´å¡«å……æ›²çº¿ï¼ˆä¾‹å¦‚ Z-order æˆ– Hilbert æ›²çº¿ï¼‰å°† 3D ç‚¹äº‘æ’åˆ—æˆ 1D åºåˆ—ï¼›ä»è€Œå°†æ— åºç‚¹äº‘è½¬åŒ–ä¸ºç»“æ„åŒ–æ•°æ®ï¼Œä½¿å¾—é‚»è¿‘çš„ç‚¹åœ¨åºåˆ—ä¸­ä¹Ÿå°½å¯èƒ½é‚»è¿‘ï¼Œä»è€Œèƒ½å¤Ÿåˆ©ç”¨é«˜æ•ˆçš„æ»‘çª—æœºåˆ¶ã€‚</li>
</ul>
<p>2ã€åºåˆ—åŒ–æ³¨æ„åŠ›ï¼ˆSerialized Attentionï¼‰</p>
<ul>
<li>åœ¨åºåˆ—åŒ–åçš„ç‚¹äº‘ä¸Šä½¿ç”¨åŸºäº Patch çš„æ³¨æ„åŠ›æœºåˆ¶ï¼ˆç±»ä¼¼äº Swin Transformerï¼‰ï¼›</li>
<li>æå‡ºäº† Shift Mask å’Œ Shuffle ç­‰ç­–ç•¥æ¥ä¿ƒè¿›ä¸åŒ Patch ä¹‹é—´çš„ä¿¡æ¯äº¤äº’ï¼Œæ‰“ç ´å›ºå®šçª—å£çš„é™åˆ¶ï¼›</li>
<li>ä¸ºäº†æè‡´æ•ˆç‡ï¼ŒPTv3 æ”¾å¼ƒäº† Vector Attenionï¼Œå›å½’åˆ°äº†ç‚¹ç§¯æ³¨æ„åŠ›ï¼Œè¿™ä½¿å¾—å®ƒèƒ½åˆ©ç”¨ FlashAttention ç­‰åŠ é€ŸæŠ€æœ¯ã€‚</li>
</ul>
<p>3ã€xCPEï¼ˆEnhanced Conditional Positional Encodingï¼‰</p>
<ul>
<li>ç§»é™¤äº†è€—æ—¶çš„ RPEï¼Œæ”¹ç”¨ä¸€ä¸ªå‰ç½®çš„ç¨€ç–å·ç§¯å±‚ï¼ˆSparse Convolutionï¼‰æ¥éšå¼ç¼–ç ä½ç½®ä¿¡æ¯ï¼Œæ•ˆç‡æé«˜ã€‚</li>
</ul>
<p><mark>å…³é”®è´¡çŒ®ä¸æ•ˆæœ</mark></p>
<ul>
<li><strong>è§„æ¨¡å³æ­£ä¹‰ï¼š</strong> è¯æ˜äº†é€šè¿‡ç®€åŒ–è®¾è®¡ï¼ˆæ”¾å¼ƒç²¾ç¡®çš„ kNNï¼Œä½¿ç”¨åºåˆ—åŒ–è¿‘ä¼¼ï¼‰ï¼Œæ¢å–æ›´å¤§çš„ <strong>è§„æ¨¡</strong>ï¼ˆæ„Ÿå—é‡ä» 16 ç‚¹æ‰©å±•åˆ° 1024 ç‚¹ï¼‰æ˜¯å€¼å¾—çš„ ã€‚</li>
<li><strong>æè‡´æ•ˆç‡ï¼š</strong> ç›¸æ¯” PTv2ï¼Œæ¨ç†é€Ÿåº¦æå‡ <strong>3.3 å€</strong>ï¼Œå†…å­˜æ¶ˆè€—é™ä½ <strong>10 å€</strong> ã€‚</li>
<li><strong>æ•ˆæœï¼š</strong> åœ¨å®¤å†…ï¼ˆScanNet, S3DISï¼‰å’Œå®¤å¤–ï¼ˆnuScenes, Waymoï¼‰å…± 20 å¤šä¸ªä»»åŠ¡ä¸Šè¾¾åˆ° SOTAã€‚ç‰¹åˆ«æ˜¯ç»“åˆå¤šæ•°æ®é›†è”åˆè®­ç»ƒï¼ˆPPTï¼‰ï¼ŒScanNet mIoU è¾¾åˆ°äº† <strong>79.4%</strong> ã€‚</li>
</ul>
<h3 id="point-cloud-serialization">Point Cloud Serialization</h3>
<p>ptv3 çš„æ ¸å¿ƒçªç ´åœ¨äºæŠ›å¼ƒäº†ä¼ ç»Ÿç‚¹äº‘ç½‘ç»œä¸­æ˜‚è´µçš„é‚»åŸŸæŸ¥è¯¢ï¼ˆKNN æˆ– Ball Queryï¼‰ï¼Œè½¬è€Œä½¿ç”¨ç©ºé—´å¡«å……æ›²çº¿æ¥å®ç°é«˜æ•ˆçš„å±€éƒ¨æ€§åˆ†ç»„ã€‚</p>
<p><mark>ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ï¼Ÿ</mark></p>
<p>ä¼ ç»Ÿåšæ³•ï¼ˆå¦‚ ptv2/v1ï¼ŒPointNet++ï¼‰ï¼Œä¸å¯¹ç‚¹åšä»»ä½•å¤„ç†ï¼Œå°†ç‚¹é›†è§†ä¸ºæ— åºé›†åˆï¼Œç‚¹åœ¨å†…å­˜ä¸­æ˜¯ä¹±åºå­˜å‚¨çš„ï¼›ä¸ºäº†åšå·ç§¯æˆ– attentionï¼Œå¿…é¡»å…ˆæ‰¾åˆ°é‚»å±…ï¼Œç¡®å®šè®¡ç®—æ³¨æ„åŠ›æˆ–è€…å·ç§¯çš„èŒƒå›´ï¼Œè¿™éœ€è¦ KNN æˆ– Radius Search æ¥æœå¯»é‚»å±…ï¼Œè¿™äº›æ“ä½œè®¾è®¡å¤§é‡çš„éšæœºå†…å­˜è®¿é—®ï¼ˆRandom Memory Accessï¼‰ï¼Œå¯¹ GPU æå…¶ä¸å‹å¥½ï¼Œå¯¼è‡´æ˜¾å­˜å ç”¨é«˜ã€é€Ÿåº¦æ…¢ã€‚</p>
<p>ptv3 é€šè¿‡æŒ‰ç…§æŸç§ç‰¹å®šè§„åˆ™ï¼Œå¦‚ï¼ˆz-order æˆ– Hilbert æ›²çº¿ï¼‰ï¼ŒæŠŠç‚¹äº‘æŒ‰ç…§ç©ºé—´ä½ç½®æ’å¥½åºï¼Œé€šå¸¸æŒ‰ç…§è¿™ç§ç©ºé—´å¡«å……æ›²çº¿çš„è¿æ¥é¡ºåºæ’åºï¼Œè¿™æ ·åœ¨æ›²çº¿é¡ºåºä¸Šç›¸é‚»ï¼ˆå†…å­˜é‡Œç›¸é‚»ï¼‰çš„ç‚¹ï¼Œåœ¨ 3D ç©ºé—´é‡Œå¤§æ¦‚ç‡ä¹Ÿæ˜¯ç›¸é‚»çš„ã€‚è¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦è¿›è¡Œè€—æ—¶çš„ KNN æ¥æ‰¾é‚»å±…äº†ï¼Œç›´æ¥åˆ‡ä¸€æ®µå†…å­˜ï¼ˆPatchï¼‰å‡ºæ¥ç®— Attention å°±å¯ä»¥äº†ã€‚</p>
<p><mark>åºåˆ—åŒ–çš„å…·ä½“æµç¨‹</mark></p>
<p>ptv3 çš„åºåˆ—åŒ–è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šç½‘æ ¼åŒ–ï¼ˆGridï¼‰-&gt; ç¼–ç ï¼ˆcodeï¼‰-&gt; æ’åºï¼ˆsortï¼‰-&gt; åˆ†å—(Patch)ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šç½‘æ ¼åŒ–ä¸åæ ‡æ˜ å°„ï¼ˆGrid Samplingï¼‰</p>
<p>é¦–å…ˆå°†è¿ç»­çš„æµ®ç‚¹æ•°åæ ‡ <span class="arithmatex">\((x,y,z)\)</span> æ˜ å°„åˆ°ç¦»æ•£çš„æ•´æ•°ç½‘æ ¼åæ ‡ <span class="arithmatex">\((x_{idx},y_{idx},z_{idx})\)</span> ä¸Šï¼Œè¿™ä¸€æ­¥æœ‰ç‚¹åƒä½“ç´ åŒ–ï¼Œç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿åç»­çš„ç¼–ç ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šç©ºé—´å¡«å……æ›²çº¿ç¼–ç ï¼ˆSpace-Filling Curve Encodingï¼‰</p>
<p>è¿™ä¸€æ­¥æ˜¯åºåˆ—åŒ–çš„çµé­‚æ˜¯ï¼Œæ˜¯å†³å®šç‚¹äº‘åºåˆ—é¡ºåºçš„å…³é”®ã€‚ptv3 é€šå¸¸ä½¿ç”¨ z-order curveï¼ˆMorton Codeï¼‰æˆ– Hilbert Curveã€‚å®ƒä»¬å¯ä»¥å°† 3D çš„æ•´æ•°åæ ‡(x, y, z)è½¬åŒ–æˆä¸€ä¸ªä¸ºå”¯ä¸€çš„ 1D æ•´æ•°ï¼Œå¹¶ä¸”å…·æœ‰è‰¯å¥½çš„ç©ºé—´å±€éƒ¨æ€§ï¼Œä¹Ÿå°±æ˜¯åœ¨ 3D ç©ºé—´ä¸­é è¿‘çš„ä¸¤ä¸ªç‚¹ï¼Œå®ƒä»¬çš„ Morton Code æ•°å€¼é€šå¸¸ä¹Ÿéå¸¸æ¥è¿‘ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šæ’åºï¼ˆSortingï¼‰</p>
<p>æ ¹æ®è®¡ç®—å‡ºçš„ Morton Code äºŒè¿›åˆ¶å€¼å¾—å¤§å°å¯¹æ‰€æœ‰ç‚¹è¿›è¡Œé‡æ’ã€‚é‡æ’åï¼Œå†…å­˜ä¸­å¾—ç‚¹äº‘ä¸å†æ˜¯ä¹±åºçš„ï¼Œè€Œæ˜¯æ ¹æ® Morton Code çš„å¤§å°é¡ºåºåœ¨å†…å­˜ä¸­è¿ç»­æ’åˆ—ï¼Œè¿™äº›ç‚¹åœ¨ç©ºé—´ä¸­ä¼šæ²¿ç€ Z å­—å½¢æ›²çº¿åœ¨ç©ºé—´ä¸­èœ¿èœ’æ’åˆ—ã€‚</p>
<p>ç¬¬å››æ­¥ï¼šåˆ†å—ï¼ˆPatching/Flatteningï¼‰</p>
<p>å°†æ’å¥½åºçš„é•¿åºåˆ—ï¼Œç›´æ¥æŒ‰ç…§å›ºå®šçš„é•¿åº¦ï¼ˆBlock Sizeï¼Œä¾‹å¦‚ 1024 æˆ– 2048ï¼‰åˆ‡åˆ†æˆè‹¥å¹²ä¸ª Patchï¼Œè¿™ä¸€æ­¥å°±æ˜¯ç”¨æ¥ç¡®å®šæ³¨æ„åŠ›çš„è®¡ç®—èŒƒå›´çš„ï¼Œç›¸æ¯”äº knn çš„é‚»åŸŸæŸ¥è¯¢ï¼Œç”±äºæŸ¥è¯¢å¤æ‚ï¼Œé‚»åŸŸä¸€èˆ¬è®¾ä¸º 16 æˆ–è€… 32ï¼Œå¾ˆéš¾æå‡ï¼Œä½†æ˜¯è¿™é‡Œç”±äºè¿™ä¸ªé•¿åºåˆ—åœ¨å†…å­˜ä¸­è¿ç»­æ’åˆ—ï¼Œå¯ä»¥è½»æ¾é€šè¿‡ reshape å®ç°åˆ†å—ï¼Œé€Ÿåº¦æå¿«ï¼ŒåŒæ—¶é‚»åŸŸå¯ä»¥è½»æ¾è®¾ç½®çš„å¾ˆå¤§ï¼Œå¦‚ 1024 æˆ– 2048ï¼Œä¸”å¯¹è€—æ—¶æ²¡æœ‰å½±å“ã€‚</p>
<h3 id="serialized-attention">åºåˆ—åŒ–æ³¨æ„åŠ›ï¼ˆSerialized Attentionï¼‰</h3>
<p>å®Œæˆä¸Šè¿°åºåˆ—åŒ–ä¹‹åï¼Œ3D ä»»åŠ¡å°±å˜æˆäº† 1D åºåˆ—ä»»åŠ¡ã€‚</p>
<p>å±€éƒ¨ attentionï¼Œåœ¨æ¯ä¸€ä¸ª patch å†…éƒ¨è¿›è¡Œ self-attention è¿ç®—ï¼ˆæ ‡å‡†çš„ç‚¹ç§¯æ³¨æ„åŠ›ï¼‰ï¼Œå¯¹ patch å†…éƒ¨æ‰€æœ‰ç‚¹è¿›è¡Œç‰¹å¾æ›´æ–°ï¼›</p>
<h3 id="xcpe">ä½ç½®ç¼–ç ï¼ˆxCPEï¼‰</h3>
<p>åœ¨å°† 3D ç‚¹äº‘ä½¿ç”¨åºåˆ—åŒ–å±•å¹³ä¸º 1D åºåˆ—ä¹‹å‰ï¼Œå¯¹ 3D ç‚¹äº‘è¿›è¡Œç¨€ç–å·ç§¯ï¼Œå°†è®¡ç®—ç»“æœä½œä¸ºä½ç½®ç¼–ç ï¼ŒåŠ åˆ°ç‚¹çš„ç‰¹å¾ä¸­ï¼Œç„¶åå±•å¹³çš„ 1D åºåˆ—çš„ç‚¹çš„ç‰¹å¾ä¸­å°±åŒ…å«äº†ä½ç½®ç¼–ç ä¿¡æ¯ï¼Œç›¸æ¯”äº ptv2 ä½¿ç”¨åæ ‡å·®ï¼Œç»è¿‡ mlp æ˜ å°„çš„åæ ‡ç¼–ç è®¡ç®—æ–¹å¼æ¥è¯´ï¼Œé¿å…äº† KNN é‚»åŸŸæŸ¥è¯¢ï¼ŒåŒæ—¶æ³¨æ„åŠ›é€€åŒ–ä½¿ç”¨æ ‡å‡†ç‚¹ç§¯æ³¨æ„åŠ›ï¼Œå¯ä»¥é€šè¿‡ FlashAttention æ¥åŠ é€Ÿè®¡ç®—ã€‚</p>
<p>ä½†æ˜¯ç®€å•çš„æ’åºåˆ‡ç‰‡æœ‰ä¸€ä¸ªè‡´å‘½å¼±ç‚¹ï¼š<strong>è¾¹ç•Œæ•ˆåº”</strong>ã€‚æ¯”å¦‚ç‚¹ A ç´¢å¼• 1023ï¼Œç‚¹ B åœ¨ç´¢å¼• 1024ï¼Œå®ƒä¿©åœ¨ 3D ç©ºé—´å¯èƒ½ç´§æŒ¨ç€ï¼Œä½†æ˜¯å´è¢«å¼ºè¡Œåˆ‡åˆ†åˆ°äº†ä¸¤ä¸ªä¸åŒçš„ Patch é‡Œï¼Œå¯¼è‡´æ— æ³•åœ¨æ³¨æ„åŠ›æœºåˆ¶ä¸­äº¤äº’ã€‚è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¤šé‡æ’åºï¼Œåœ¨ä¸åŒçš„ Transformer å±‚ä¸­ï¼Œä½¿ç”¨ä¸åŒçš„æ’åºé€»è¾‘ï¼ˆä¾‹å¦‚å±‚ 1 ç”¨ z-orderï¼Œå±‚ 2 ç”¨ Hilbertï¼Œæˆ–è€…å¯¹åæ ‡è¿›è¡Œ shift å†æ’åºï¼‰ï¼Œå¤„ç†ä¹‹åï¼Œè¿™ä¸€å±‚çš„è¾¹ç•Œç‚¹ï¼Œåœ¨ä¸‹ä¸€å±‚é‡æ–°æ’åºåå¯èƒ½å°±å˜æˆäº†ä¸­å¿ƒç‚¹ï¼Œé€šè¿‡å¤šå±‚å †å ï¼Œä¿¡æ¯å°±èƒ½åœ¨æ•´ä¸ªç‚¹äº‘ä¸­æµåŠ¨ã€‚</li>
</ul>
<p>æ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ¯æ¬¡è®¡ç®—åºåˆ—æ³¨æ„åŠ›ä¹‹å‰ï¼Œä½¿ç”¨ä¸åŒçš„åºåˆ—åŒ–é¡ºåºï¼Œå¾—åˆ°ä¸åŒçš„ 1D åºåˆ—ï¼Œè¿™æ ·æ¯ä¸€å±‚è®¡ç®—æ³¨æ„åŠ›çš„é‚»å±…éƒ½ä¸åŒï¼Œè¿™ä¸€å±‚å¯èƒ½å°†é‚»å±…æ‹†å¼€äº†ï¼Œå¯èƒ½ä¸‹ä¸€å±‚å°±åœ¨ä¸€èµ·äº†ï¼Œè¿™æ ·æ³¨æ„åŠ›çš„äº¤äº’å°±èƒ½è·¨è¶Šæ›´å¤§èŒƒå›´ï¼Œåœ¨æ•´ä¸ªç‚¹äº‘é—´æµåŠ¨ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a href="https://gemini.google.com/share/ec86de0c8113">Gemini å¯¹è¯è®°å½•</a></p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="æœ€åæ›´æ–°">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025å¹´12æœˆ29æ—¥ 12:15:14 UTC">2025å¹´12æœˆ29æ—¥</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025å¹´12æœˆ29æ—¥ 12:15:14 UTC">2025å¹´12æœˆ29æ—¥</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  å›åˆ°é¡µé¢é¡¶éƒ¨
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "toc.follow", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/polyfill-service/3.111.0/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>